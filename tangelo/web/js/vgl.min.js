if(typeof ogs==="undefined"){var ogs={}}ogs.namespace=function(e){"use strict";var t=e.split("."),r=ogs,i;if(t[0]==="ogs"){t=t.slice(1)}for(i=0;i<t.length;i+=1){if(typeof r[t[i]]==="undefined"){r[t[i]]={}}r=r[t[i]]}return r};var vgl=ogs.namespace("gl");function inherit(e,t){"use strict";var r=function(){};r.prototype=t.prototype;e.prototype=new r;e.uber=t.prototype;e.prototype.constructor=e}Object.size=function(e){"use strict";var t=0,r=null;for(r in e){if(e.hasOwnProperty(r)){t++}}return t};vgl.GL={ColorBufferBit:16384,DepthBufferBit:256};var m_globalModifiedTime=0;vgl.timestamp=function(){"use strict";if(!(this instanceof vgl.timestamp)){return new vgl.timestamp}var e=0;this.modified=function(){++m_globalModifiedTime;e=m_globalModifiedTime};this.getMTime=function(){return e}};vgl.object=function(){"use strict";if(!(this instanceof vgl.object)){return new vgl.object}var e=vgl.timestamp();e.modified();this.modified=function(){e.modified()};this.getMTime=function(){return e.getMTime()};return this};vgl.event=function(){"use strict";if(!(this instanceof vgl.event)){return new vgl.event}vgl.object.call(this);return this};inherit(vgl.event,vgl.object);vgl.event.keyPress="vgl.event.keyPress";vgl.event.mousePress="vgl.event.mousePress";vgl.event.mouseRelease="vgl.event.mouseRelease";vgl.event.contextMenu="vgl.event.contextMenu";vgl.event.configure="vgl.event.configure";vgl.event.enable="vgl.event.enable";vgl.event.mouseWheel="vgl.event.mouseWheel";vgl.event.keyRelease="vgl.event.keyRelease";vgl.event.middleButtonPress="vgl.event.middleButtonPress";vgl.event.startInteraction="vgl.event.startInteraction";vgl.event.enter="vgl.event.enter";vgl.event.rightButtonPress="vgl.event.rightButtonPress";vgl.event.middleButtonRelease="vgl.event.middleButtonRelease";vgl.event.char="vgl.event.char";vgl.event.disable="vgl.event.disable";vgl.event.endInteraction="vgl.event.endInteraction";vgl.event.mouseMove="vgl.event.mouseMove";vgl.event.mouseOut="vgl.event.mouseOut";vgl.event.expose="vgl.event.expose";vgl.event.timer="vgl.event.timer";vgl.event.leftButtonPress="vgl.event.leftButtonPress";vgl.event.leave="vgl.event.leave";vgl.event.rightButtonRelease="vgl.event.rightButtonRelease";vgl.event.leftButtonRelease="vgl.event.leftButtonRelease";vgl.boundingObject=function(){"use strict";if(!(this instanceof vgl.boundingObject)){return new vgl.boundingObject}vgl.object.call(this);var e=[0,0,0,0,0,0],t=vgl.timestamp(),r=vgl.timestamp();t.modified();r.modified();this.bounds=function(){return e};this.setBounds=function(r,i,n,a,o,l){e[0]=r;e[1]=i;e[2]=n;e[3]=a;e[4]=o;e[5]=l;this.modified();t.modified();return true};this.resetBounds=function(){e[0]=Number.MAX_VALUE;e[1]=-Number.MAX_VALUE;e[2]=Number.MAX_VALUE;e[3]=-Number.MAX_VALUE;e[4]=Number.MAX_VALUE;e[5]=-Number.MAX_VALUE;this.modified()};this.computeBounds=function(){};this.computeBoundsTimestamp=function(){return t};this.boundsDirtyTimestamp=function(){return r};this.resetBounds();return this};vgl.boundingObject.ReferenceFrame={Relative:0,Absolute:1};inherit(vgl.boundingObject,vgl.object);vgl.node=function(){"use strict";if(!(this instanceof vgl.node)){return new vgl.node}vgl.boundingObject.call(this);var e=null,t=null,r=true,i=false;this.accept=function(e){e.visit(this)};this.material=function(){return t};this.setMaterial=function(e){if(e!==t){t=e;this.modified();return true}return false};this.visible=function(){return r};this.setVisible=function(e){if(e!==r){r=e;this.modified();return true}return false};this.parent=function(){return e};this.setParent=function(t){if(t!==e){if(e!==null){e.removeChild(this)}e=t;this.modified();return true}return false};this.overlay=function(){return i};this.setOverlay=function(e){if(i!==e){i=e;this.modified();return true}return false};this.ascend=function(e){};this.traverse=function(e){};this.boundsModified=function(){this.boundsDirtyTimestamp().modified();if(e!==null){e.boundsModified()}};return this};inherit(vgl.node,vgl.boundingObject);vgl.groupNode=function(){"use strict";if(!(this instanceof vgl.groupNode)){return new vgl.groupNode}vgl.node.call(this);var e=[];this.b_setVisible=this.setVisible;this.setVisible=function(t){var r;if(this.b_setVisible(t)!==true){return false}for(r=0;r<e.length;++r){e[r].setVisible(t)}return true};this.addChild=function(t){if(t instanceof vgl.node){if(e.indexOf(t)===-1){t.setParent(this);e.push(t);this.boundsDirtyTimestamp().modified();return true}return false}return false};this.removeChild=function(t){if(t.parent()===this){var r=e.indexOf(t);e.splice(r,1);this.boundsDirtyTimestamp().modified();return true}};this.removeChildren=function(){var t;for(t=0;t<e.length;++t){this.removeChild(e[t])}this.modified()};this.children=function(){return e};this.accept=function(e){e.visit(this)};this.traverse=function(e){switch(e.type()){case e.UpdateVisitor:this.traverseChildrenAndUpdateBounds(e);break;case e.CullVisitor:this.traverseChildren(e);break;default:break}};this.traverseChildrenAndUpdateBounds=function(t){var r;if(this.m_parent&&this.boundsDirtyTimestamp().getMTime()>this.computeBoundsTimestamp().getMTime()){this.m_parent.boundsDirtyTimestamp.modified()}this.computeBounds();if(t.mode()===t.TraverseAllChildren){for(r=0;r<e.length();++r){e[r].accept(t);this.updateBounds(e[r])}}this.computeBoundsTimestamp().modified()};this.traverseChildren=function(t){var r;if(t.mode()===vgl.vesVisitor.TraverseAllChildren){for(r=0;r<e.length();++r){e[r].accept(t)}}};this.computeBounds=function(){var t=0;if(this.computeBoundsTimestamp().getMTime()>this.boundsDirtyTimestamp().getMTime()){return}for(t=0;t<e.length;++t){this.updateBounds(e[t])}};this.updateBounds=function(e){if(e.overlay()){return}e.computeBounds();var t=this.bounds(),r=e.bounds(),i=0,n=0,a;for(a=0;a<3;++a){i=a*2;n=a*2+1;if(r[i]<t[i]){t[i]=r[i]}if(r[n]>t[n]){t[n]=r[n]}}this.setBounds(t[0],t[1],t[2],t[3],t[4],t[5])};return this};inherit(vgl.groupNode,vgl.node);vgl.actor=function(){"use strict";if(!(this instanceof vgl.actor)){return new vgl.actor}vgl.node.call(this);var e=mat4.create(),t=vgl.boundingObject.ReferenceFrame.Relative,r=null;this.matrix=function(){return e};this.setMatrix=function(t){if(t!==e){e=t;this.modified()}};this.referenceFrame=function(){return t};this.setReferenceFrame=function(e){if(e!==t){t=e;this.modified();return true}return false};this.mapper=function(){return r};this.setMapper=function(e){if(e!==r){r=e;this.boundsModified()}};this.accept=function(e){};this.ascend=function(e){};this.computeLocalToWorldMatrix=function(e,t){};this.computeWorldToLocalMatrix=function(e,t){};this.computeBounds=function(){if(r===null||r===undefined){this.resetBounds();return}var t=this.computeBoundsTimestamp(),i,n,a,o,l;if(this.boundsDirtyTimestamp().getMTime()>t.getMTime()||r.boundsDirtyTimestamp().getMTime()>t.getMTime()){r.computeBounds();i=r.bounds();n=[i[0],i[2],i[4]];a=[i[1],i[3],i[5]];vec3.transformMat4(n,n,e);vec3.transformMat4(a,a,e);l=[n[0]>a[0]?a[0]:n[0],n[0]>a[0]?n[0]:a[0],n[1]>a[1]?a[1]:n[1],n[1]>a[1]?n[1]:a[1],n[2]>a[2]?a[2]:n[2],n[2]>a[2]?n[2]:a[2]];this.setBounds(l[0],l[1],l[2],l[3],l[4],l[5]);t.modified()}};return this};inherit(vgl.actor,vgl.node);vgl.freezeObject=function(e){"use strict";var t=Object.freeze(e);if(typeof t==="undefined"){t=function(e){return e}}return t};vgl.defaultValue=function(e,t){"use strict";if(typeof e!=="undefined"){return e}return t};vgl.defaultValue.EMPTY_OBJECT=vgl.freezeObject({});vgl.geojsonReader=function(){"use strict";if(!(this instanceof vgl.geojsonReader)){return new vgl.geojsonReader}var e="none",t=null;this.readScalars=function(e,t,r,i){var n=null,a=null,o=null,l=null,s=null;if(this.m_scalarFormat==="values"&&e.length===4){a=e[3];n=t.sourceData(vgl.vertexAttributeKeys.Scalar);if(!n){n=new vgl.sourceDataSf;if(this.m_scalarRange){n.setScalarRange(this.m_scalarRange[0],this.m_scalarRange[1])}if(r!==undefined){n.data().length=r}t.addSource(n)}if(r===undefined){n.pushBack(a)}else{n.insertAt(i,a)}}else if(this.m_scalarFormat==="rgb"&&e.length===6){n=t.sourceData(vgl.vertexAttributeKeys.Color);if(!n){n=new vgl.sourceDataC3fv;if(r!==undefined){n.length=r*3}t.addSource(n)}o=e[3];l=e[4];s=e[5];if(r===undefined){n.pushBack([o,l,s])}else{n.insertAt(i,[o,l,s])}}};this.readPoint=function(e){var t=new vgl.geometryData,r=new vgl.points,i=new vgl.sourceDataP3fv,n=new Uint16Array(1),a=null,o=null,l=null,s=null;t.addSource(i);for(s=0;s<1;s++){n[s]=s;a=e[0];o=e[1];l=0;if(e.length>2){l=e[2]}i.pushBack([a,o,l]);this.readScalars(e,t)}r.setIndices(n);t.addPrimitive(r);t.setName("aPoint");return t};this.readMultiPoint=function(e){var t=new vgl.geometryData,r=new vgl.points,i=new vgl.sourceDataP3fv,n=new Uint16Array(e.length),a=0,o=e.length,l=null,s=null,u=null,f;i.data().length=o*3;for(f=0;f<e.length;f++){n[f]=f;l=e[f][0];s=e[f][1];u=0;if(e[f].length>2){u=e[f][2]}i.insertAt(a,[l,s,u]);this.readScalars(e[f],t,o,a);a++}r.setIndices(n);t.addPrimitive(r);t.addSource(i);t.setName("manyPoints");return t};this.readLineString=function(e){var t=new vgl.geometryData,r=new vgl.lineStrip,i=new vgl.sourceDataP3fv,n=[],a=null,o=null,l=null,s=null;r.setIndicesPerPrimitive(e.length);for(a=0;a<e.length;a++){n.push(a);o=e[a][0];l=e[a][1];s=0;if(e[a].length>2){s=e[a][2]}i.pushBack([o,l,s]);this.readScalars(e[a],t)}r.setIndices(n);t.addPrimitive(r);t.addSource(i);t.setName("aLineString");return t};this.readMultiLineString=function(e){var t=new vgl.geometryData,r=new vgl.sourceDataP3fv,i=0,n=e.length*2,a=null,o=null,l=null,s=null,u=null,f=null,c=null,h=null;r.data().length=n*3;for(o=0;o<e.length;o++){f=[];c=new vgl.lineStrip;h=e[o].length;c.setIndicesPerPrimitive(h);for(a=0;a<h;a++){f.push(i);l=e[o][a][0];s=e[o][a][1];u=0;if(e[o][a].length>2){u=e[o][a][2]}r.insertAt(i,[l,s,u]);this.readScalars(e[o][a],t,n*2,i);i++}c.setIndices(f);t.addPrimitive(c)}t.setName("aMultiLineString");t.addSource(r);return t};this.readPolygon=function(e){var t=new vgl.geometryData,r=new vgl.sourceDataP3fv,i=null,n=null,a=null,o=e[0].length,l=1,s=null,u=null,f=null;for(s=0;s<o;s++){i=e[0][s][0];n=e[0][s][1];a=0;if(e[0][s].length>2){a=e[0][s][2]}r.pushBack([i,n,a]);this.readScalars(e[0][s],t);if(s>1){u=new Uint16Array([0,l,s]);f=new vgl.triangles;f.setIndices(u);t.addPrimitive(f);l=s}}t.setName("POLY");t.addSource(r);return t};this.readMultiPolygon=function(e){var t=new vgl.geometryData,r=new vgl.sourceDataP3fv,i=0,n=e.length,a=0,o=n*3,l=new vgl.triangles,s=[],u=null,f=null,c=null,h=null,d=null,g=null,v=null,m=null,p=null,b=false,x=0;r.data().length=n*3;for(f=0;f<n;f++){g=e[f][0].length;v=i;m=i+1;p=[false,false,false];for(u=0;u<g;u++){c=e[f][0][u][0];h=e[f][0][u][1];d=0;if(e[f][0][u].length>2){d=e[f][0][u][2]}b=false;if(c>180){b=true;c=c-360}if(u===0){p[0]=b}else{p[1+(u-1)%2]=b}r.insertAt(a,[c,h,d]);this.readScalars(e[f][0][u],t,o,a);a++;if(u>1){if(p[0]===p[1]&&p[1]===p[2]){s[x*3+0]=v;s[x*3+1]=m;s[x*3+2]=i;x++}m=i}i++}}l.setIndices(s);t.addPrimitive(l);t.setName("aMultiPoly");t.addSource(r);return t};this.readGJObjectInt=function(e){if(!e.hasOwnProperty("type")){return null}if(e.properties&&e.properties.ScalarFormat&&e.properties.ScalarFormat==="values"){this.m_scalarFormat="values";if(e.properties.ScalarRange){this.m_scalarRange=e.properties.ScalarRange}}if(e.properties&&e.properties.ScalarFormat&&e.properties.ScalarFormat==="rgb"){this.m_scalarFormat="rgb"}var t,r=e.type,i=null,n=null,a=null;switch(r){case"Point":t=this.readPoint(e.coordinates);break;case"MultiPoint":t=this.readMultiPoint(e.coordinates);break;case"LineString":t=this.readLineString(e.coordinates);break;case"MultiLineString":t=this.readMultiLineString(e.coordinates);break;case"Polygon":t=this.readPolygon(e.coordinates);break;case"MultiPolygon":t=this.readMultiPolygon(e.coordinates);break;case"GeometryCollection":n=[];for(a=0;a<e.geometries.length;a++){i=this.readGJObject(e.geometries[a]);n.push(i)}t=n;break;case"Feature":i=this.readGJObject(e.geometry);t=i;break;case"FeatureCollection":n=[];for(a=0;a<e.features.length;a++){i=this.readGJObject(e.features[a]);n.push(i)}t=n;break;default:console.log("Don't understand type "+r);t=null;break}return t};this.readGJObject=function(e){var t;t=this.readGJObjectInt(e);return t};this.linearizeGeoms=function(e,t){var r=null;if(Object.prototype.toString.call(t)==="[object Array]"){for(r=0;r<t.length;r++){this.linearizeGeoms(e,t[r])}}else{e.push(t)}};this.readGeomObject=function(e){var t,r=[];t=this.readGJObject(e);this.linearizeGeoms(r,t);return r};this.getPrimitives=function(e){if(!e){return[]}var t=JSON.parse(e),r=this.readGJObject(t),i=[];this.m_scalarFormat="none";this.m_scalarRange=null;this.linearizeGeoms(i,r);return{geoms:i,scalarFormat:this.m_scalarFormat,scalarRange:this.m_scalarRange}};return this};vgl.data=function(){"use strict";if(!(this instanceof vgl.data)){return new vgl.data}this.type=function(){}};vgl.data.raster=0;vgl.data.point=1;vgl.data.lineString=2;vgl.data.polygon=3;vgl.data.geometry=10;var vertexAttributeKeys={Position:0,Normal:1,TextureCoordinate:2,Color:3,Scalar:4};vgl.primitive=function(){"use strict";if(!(this instanceof vgl.primitive)){return new vgl.primitive}var e=0,t=0,r=0,i=null;this.indices=function(){return i};this.createIndices=function(e){i=new Uint16Array};this.numberOfIndices=function(){return i.length};this.sizeInBytes=function(){return i.length*Uint16Array.BYTES_PER_ELEMENT};this.primitiveType=function(){return t};this.setPrimitiveType=function(e){t=e};this.indicesPerPrimitive=function(){return e};this.setIndicesPerPrimitive=function(t){e=t};this.indicesValueType=function(){return r};this.setIndicesValueType=function(e){r=e};this.setIndices=function(e){i=new Uint16Array(e)};return this};vgl.triangleStrip=function(){"use strict";if(!(this instanceof vgl.triangleStrip)){return new vgl.triangleStrip}vgl.primitive.call(this);this.setPrimitiveType(gl.TRIANGLE_STRIP);this.setIndicesValueType(gl.UNSIGNED_SHORT);this.setIndicesPerPrimitive(3);return this};inherit(vgl.triangleStrip,vgl.primitive);vgl.triangles=function(){"use strict";if(!(this instanceof vgl.triangles)){return new vgl.triangles}vgl.primitive.call(this);this.setPrimitiveType(gl.TRIANGLES);this.setIndicesValueType(gl.UNSIGNED_SHORT);this.setIndicesPerPrimitive(3);return this};inherit(vgl.triangles,vgl.primitive);vgl.lines=function(){"use strict";if(!(this instanceof vgl.lines)){return new vgl.lines}vgl.primitive.call(this);this.setPrimitiveType(gl.LINES);this.setIndicesValueType(gl.UNSIGNED_SHORT);this.setIndicesPerPrimitive(2);return this};inherit(vgl.lines,vgl.primitive);vgl.lineStrip=function(){"use strict";if(!(this instanceof vgl.lineStrip)){return new vgl.lineStrip}vgl.primitive.call(this);this.setPrimitiveType(gl.LINE_STRIP);this.setIndicesValueType(gl.UNSIGNED_SHORT);this.setIndicesPerPrimitive(2);return this};inherit(vgl.lineStrip,vgl.primitive);vgl.points=function(){"use strict";if(!(this instanceof vgl.points)){return new vgl.points}vgl.primitive.call(this);this.setPrimitiveType(gl.POINTS);this.setIndicesValueType(gl.UNSIGNED_SHORT);this.setIndicesPerPrimitive(1);return this};inherit(vgl.points,vgl.primitive);vgl.vertexDataP3f=function(){"use strict";if(!(this instanceof vgl.vertexDataP3f)){return new vgl.vertexDataP3f}this.m_position=[];return this};vgl.vertexDataP3N3f=function(){"use strict";if(!(this instanceof vgl.vertexDataP3N3f)){return new vgl.vertexDataP3N3f}this.m_position=[];this.m_normal=[];return this};vgl.vertexDataP3T3f=function(){"use strict";if(!(this instanceof vgl.vertexDataP3T3f)){return new vgl.vertexDataP3T3f}this.m_position=[];this.m_texCoordinate=[];return this};vgl.sourceData=function(){"use strict";if(!(this instanceof vgl.sourceData)){return new vgl.sourceData}var e={},t=[],r=function(){this.m_numberOfComponents=0;this.m_dataType=0;this.m_dataTypeSize=0;this.m_normalized=false;this.m_stride=0;this.m_offset=0};this.data=function(){return t};this.addAttribute=function(t,i,n,a,o,l,s){if(!e.hasOwnProperty(t)){var u=new r;u.m_dataType=i;u.m_dataTypeSize=n;u.m_offset=a;u.m_stride=o;u.m_numberOfComponents=l;u.m_normalized=s;e[t]=u}};this.sizeOfArray=function(){return Object.size(t)};this.lengthOfArray=function(){return t.length};this.sizeInBytes=function(){var e=0,t=this.keys(),r;for(r=0;r<t.length();++r){e+=this.numberOfComponents(t[r])*this.sizeOfAttributeDataType(t[r])}e*=this.sizeOfArray();return e};this.hasKey=function(t){return e.hasOwnProperty(t)};this.keys=function(){return Object.keys(e)};this.numberOfAttributes=function(){return Object.size(e)};this.attributeNumberOfComponents=function(t){if(e.hasOwnProperty(t)){return e[t].m_numberOfComponents}return 0};this.normalized=function(t){if(e.hasOwnProperty(t)){return e[t].m_normalized}return false};this.sizeOfAttributeDataType=function(t){if(e.hasOwnProperty(t)){return e[t].m_dataTypeSize}return 0};this.attributeDataType=function(t){if(e.hasOwnProperty(t)){return e[t].m_dataType}return undefined};this.attributeOffset=function(t){if(e.hasOwnProperty(t)){return e[t].m_offset}return 0};this.attributeStride=function(t){if(e.hasOwnProperty(t)){return e[t].m_stride}return 0};this.pushBack=function(e){};this.insert=function(e){var r;if(!e.length){t[t.length]=e}else{for(r=0;r<e.length;r++){t[t.length]=e[r]}}};this.insertAt=function(e,r){var i;if(!r.length){t[e]=r}else{for(i=0;i<r.length;i++){t[e*r.length+i]=r[i]}}};return this};vgl.sourceDataP3T3f=function(){"use strict";if(!(this instanceof vgl.sourceDataP3T3f)){return new vgl.sourceDataP3T3f}vgl.sourceData.call(this);this.addAttribute(vgl.vertexAttributeKeys.Position,gl.FLOAT,4,0,6*4,3,false);this.addAttribute(vgl.vertexAttributeKeys.TextureCoordinate,gl.FLOAT,4,12,6*4,3,false);this.pushBack=function(e){this.insert(e.m_position);this.insert(e.m_texCoordinate)};return this};inherit(vgl.sourceDataP3T3f,vgl.sourceData);vgl.sourceDataP3N3f=function(){"use strict";if(!(this instanceof vgl.sourceDataP3N3f)){return new vgl.sourceDataP3N3f}vgl.sourceData.call(this);this.addAttribute(vgl.vertexAttributeKeys.Position,gl.FLOAT,4,0,6*4,3,false);this.addAttribute(vgl.vertexAttributeKeys.Normal,gl.FLOAT,4,12,6*4,3,false);this.pushBack=function(e){this.insert(e.m_position);this.insert(e.m_normal)};return this};inherit(vgl.sourceDataP3N3f,vgl.sourceData);vgl.sourceDataP3fv=function(){"use strict";if(!(this instanceof vgl.sourceDataP3fv)){return new vgl.sourceDataP3fv}vgl.sourceData.call(this);this.addAttribute(vgl.vertexAttributeKeys.Position,gl.FLOAT,4,0,3*4,3,false);this.pushBack=function(e){this.insert(e)};return this};inherit(vgl.sourceDataP3fv,vgl.sourceData);vgl.sourceDataT2fv=function(){"use strict";if(!(this instanceof vgl.sourceDataT2fv)){return new vgl.sourceDataT2fv}vgl.sourceData.call(this);this.addAttribute(vgl.vertexAttributeKeys.TextureCoordinate,gl.FLOAT,4,0,2*4,2,false);this.pushBack=function(e){this.insert(e)};return this};inherit(vgl.sourceDataT2fv,vgl.sourceData);vgl.sourceDataC3fv=function(){"use strict";if(!(this instanceof vgl.sourceDataC3fv)){return new vgl.sourceDataC3fv}vgl.sourceData.call(this);this.addAttribute(vgl.vertexAttributeKeys.Color,gl.FLOAT,4,0,3*4,3,false);this.pushBack=function(e){this.insert(e)};return this};inherit(vgl.sourceDataC3fv,vgl.sourceData);vgl.sourceDataSf=function(){"use strict";if(!(this instanceof vgl.sourceDataSf)){return new vgl.sourceDataSf}var e=null,t=null,r=null,i=null;vgl.sourceData.call(this);this.addAttribute(vgl.vertexAttributeKeys.Scalar,gl.FLOAT,4,0,4,1,false);this.pushBack=function(r){if(t===null||r>t){t=r}if(e===null||r<e){e=r}this.data()[this.data().length]=r};this.insertAt=function(r,i){if(t===null||i>t){t=i}if(e===null||i<e){e=i}this.data()[r]=i};this.scalarRange=function(){if(r===null||i===null){return[e,t]}return[r,i]};this.setScalarRange=function(e,t){r=e;i=t};return this};inherit(vgl.sourceDataSf,vgl.sourceData);vgl.geometryData=function(){"use strict";if(!(this instanceof vgl.geometryData)){return vgl.geometryData()}vgl.data.call(this);var e="",t=[],r=[],i=[0,0,0,0,0,0],n=vgl.timestamp(),a=vgl.timestamp();this.type=function(){return vgl.data.geometry};this.name=function(){return e};this.setName=function(t){e=t};this.addSource=function(e){if(r.indexOf(e)===-1){r.push(e);if(e.hasKey(vgl.vertexAttributeKeys.Position)){a.modified()}return true}return false};this.source=function(e){if(e<r.length){return r[e]}return 0};this.numberOfSources=function(){return r.length};this.sourceData=function(e){var t;for(t=0;t<r.length;++t){if(r[t].hasKey(e)){return r[t]}}return null};this.addPrimitive=function(e){t.push(e);return true};this.primitive=function(e){if(e<t.length){return t[e]}return null};this.numberOfPrimitives=function(){return t.length};this.bounds=function(){if(a.getMTime()>n.getMTime()){this.computeBounds()}return i};this.resetBounds=function(){i[0]=0;i[1]=0;i[2]=0;i[3]=0;i[4]=0;i[5]=0};this.setBounds=function(e,t,r,a,o,l){i[0]=e;i[1]=t;i[2]=r;i[3]=a;i[4]=o;i[5]=l;n.modified();return true};this.computeBounds=function(){if(a.getMTime()>n.getMTime()){var e=vgl.vertexAttributeKeys.Position,t=this.sourceData(e),r=t.data(),o=t.attributeNumberOfComponents(e),l=t.attributeStride(e),s=t.attributeOffset(e),u=t.sizeOfAttributeDataType(e),f=r.length,c=0,h=0,d=null,g,v;l/=u;s/=u;this.resetBounds();for(g=s;g<f;g+=l){for(v=0;v<o;++v){d=r[g+v];c=v*2;h=v*2+1;if(g===s){i[c]=d;i[h]=d}else{if(d>i[h]){i[h]=d}if(d<i[c]){i[c]=d}}}}n.modified()}};this.findClosestVertex=function(e){var t=vgl.vertexAttributeKeys.Position,r=this.sourceData(t),i=r.sizeOfAttributeDataType(t),n=r.attributeNumberOfComponents(t),a=r.data(),o=r.attributeStride(t)/i,l=r.attributeOffset(t)/i,s=Number.MAX_VALUE,u=null,f,c,h,d,g,v,m;if(n!==3){console.log("[warning] Find closest vertex assumes three"+"component vertex ")}if(!e.z){e={x:e.x,y:e.y,z:0}}for(f=l,m=0;f<a.length;f+=o,m++){c=[a[f],a[f+1],a[f+2]];h=c[0]-e.x;d=c[1]-e.y;g=c[2]-e.z;v=Math.sqrt(h*h+d*d+g*g);if(v<s){s=v;u=m}}return u};this.getPosition=function(e){var t=vgl.vertexAttributeKeys.Position,r=this.sourceData(t),i=r.sizeOfAttributeDataType(t),n=r.attributeNumberOfComponents(t),a=r.data(),o=r.attributeStride(t)/i,l=r.attributeOffset(t)/i;if(n!==3){console.log("[warning] getPosition assumes three component data")}return[a[l+e*o],a[l+e*o+1],a[l+e*o+2]]};this.getScalar=function(e){var t=vgl.vertexAttributeKeys.Scalar,r=this.sourceData(t),i,n,a,o,l;if(!r){return null}i=r.attributeNumberOfComponents(t);n=r.sizeOfAttributeDataType(t);a=r.data();o=r.attributeStride(t)/n;l=r.attributeOffset(t)/n;if(e*o+l>=a.length){console.log("access out of bounds in getScalar")}return a[e*o+l]};return this};inherit(vgl.geometryData,vgl.data);vgl.mapper=function(){"use strict";if(!(this instanceof vgl.mapper)){return new vgl.mapper}vgl.boundingObject.call(this);var e=true,t=[0,1,1],r=null,i=[],n={},a=vgl.timestamp();function o(){var e;for(e=0;e<i.length;++e){gl.deleteBuffer(i[e])}}function l(){if(r){var e=r.numberOfSources(),t,o,l,s=null,u,f,c;for(t=0;t<e;++t){s=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,s);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(r.source(t).data()),gl.STATIC_DRAW);u=r.source(t).keys();f=[];for(o=0;o<u.length;++o){f.push(u[o])}n[t]=f;i[t]=s}c=r.numberOfPrimitives();for(l=0;l<c;++l){s=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,s);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,r.primitive(l).indices(),gl.STATIC_DRAW);i[t++]=s}a.modified()}}function s(){n={};i=[]}function u(){o();s();l();e=false}this.computeBounds=function(){if(r===null||typeof r==="undefined"){this.resetBounds();return}var e=this.computeBoundsTimestamp(),t=this.boundsDirtyTimestamp(),i=null;if(t.getMTime()>e.getMTime()){i=r.bounds();this.setBounds(i[0],i[1],i[2],i[3],i[4],i[5]);e.modified()}};this.color=function(){return t};this.setColor=function(e,r,i){t[0]=e;t[1]=r;t[2]=i;this.modified()};this.geometryData=function(){return r};this.setGeometryData=function(e){if(r!==e){r=e;this.modified();this.boundsDirtyTimestamp().modified()}};this.render=function(e){if(this.getMTime()>a.getMTime()){u(e)}gl.vertexAttrib3fv(vgl.vertexAttributeKeys.Color,this.color());var t=0,o=0,l,s=null,f=null;for(l in n){if(n.hasOwnProperty(l)){gl.bindBuffer(gl.ARRAY_BUFFER,i[t]);for(o=0;o<n[l].length;++o){e.m_material.bindVertexData(e,n[l][o])}++t}}s=r.numberOfPrimitives();for(o=0;o<s;++o){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,i[t++]);f=r.primitive(o);gl.drawElements(f.primitiveType(),f.numberOfIndices(),f.indicesValueType(),0)}};return this};inherit(vgl.mapper,vgl.boundingObject);vgl.groupMapper=function(){"use strict";if(!(this instanceof vgl.groupMapper)){return new vgl.groupMapper}vgl.mapper.call(this);var e=vgl.timestamp(),t=[],r=[];this.geometryData=function(e){if(e!==undefined&&e<r.length){return r[e]}if(r.length>0){return r[0]}return null};this.setGeometryData=function(e){if(r.length===1){if(r[0]===e){return}}r=[];r.push(e);this.modified()};this.geometryDataArray=function(){return r};this.setGeometryDataArray=function(e){if(e instanceof Array){if(r!==e){r=[];r=e;this.modified();return true}}else{console.log("[error] Requies array of geometry data")}return false};this.computeBounds=function(){if(r===null||r===undefined){this.resetBounds();return}var e=this.computeBoundsTimestamp(),t=this.boundsDirtyTimestamp(),i=this.bounds(),n=null,a=null;if(t.getMTime()>e.getMTime()){for(a=0;a<r.length;++a){n=r[a].bounds();if(i[0]>n[0]){i[0]=n[0]}if(i[1]<n[1]){i[1]=n[1]}if(i[2]>n[2]){i[2]=n[2]}if(i[3]<n[3]){i[3]=n[3]}if(i[4]>n[4]){i[4]=n[4]}if(i[5]<n[5]){i[5]=n[5]}}this.modified();e.modified()}};this.render=function(i){var n=null;if(this.getMTime()>e.getMTime()){for(n=0;n<r.length;++n){t.push(vgl.mapper());t[n].setGeometryData(r[n])}e.modified()}for(n=0;n<t.length;++n){t[n].render(i)}};return this};inherit(vgl.groupMapper,vgl.mapper);vgl.materialAttributeType={Undefined:0,ShaderProgram:1,Texture:2,Blend:3,Depth:4};vgl.materialAttribute=function(e){"use strict";if(!(this instanceof vgl.materialAttribute)){return new vgl.materialAttribute}vgl.object.call(this);var t=e,r=true;this.type=function(){return t};this.enabled=function(){return r};this.setup=function(e){return false};this.bind=function(e){return false};this.undoBind=function(e){return false};this.setupVertexData=function(e,t){return false};this.bindVertexData=function(e,t){return false};this.undoBindVertexData=function(e,t){return false};return this};inherit(vgl.materialAttribute,vgl.object);vgl.blendFunction=function(e,t){"use strict";if(!(this instanceof vgl.blendFunction)){return new vgl.blendFunction(e,t)}var r=e,i=t;this.apply=function(e){gl.blendFuncSeparate(r,i,gl.ONE,gl.ONE_MINUS_SRC_ALPHA)};return this};vgl.blend=function(){"use strict";if(!(this instanceof vgl.blend)){return new vgl.blend}vgl.materialAttribute.call(this,vgl.materialAttributeType.Blend);var e=false,t=vgl.blendFunction(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);this.bind=function(r){e=gl.isEnabled(gl.BLEND);if(this.enabled()){gl.enable(gl.BLEND);t.apply(r)}else{gl.disable(gl.BLEND)}return true};this.undoBind=function(t){if(e){gl.enable(gl.BLEND)}else{gl.disable(gl.BLEND)}return true};return this};inherit(vgl.blend,vgl.materialAttribute);vgl.material=function(){"use strict";if(!(this instanceof vgl.material)){return new vgl.material}vgl.object.call(this);var e=new vgl.shaderProgram,t=100,r={},i={};this.binNumber=function(){return t};this.setBinNumber=function(e){t=e;this.modified()};this.exists=function(e){if(e.type()===vgl.materialAttribute.Texture){return r.hasOwnProperty(e)}return i.hasOwnProperty(e)};this.attribute=function(e){if(i.hasOwnProperty(e)){return i[e]}if(r.hasOwnProperty(e)){return r[e]}return null};this.setAttribute=function(t){if(t.type()===vgl.materialAttributeType.Texture&&r[t.textureUnit()]!==t){r[t.textureUnit()]=t;this.modified();return true}if(i[t.type()]===t){return false}if(t.type()===vgl.materialAttributeType.ShaderProgram){e=t}i[t.type()]=t;this.modified();return true};this.addAttribute=function(t){if(this.exists(t)){return false}if(t.type()===vgl.materialAttributeType.Texture){r[t.textureUnit()]=t;this.modified();return true}if(t.type()===vgl.materialAttributeType.ShaderProgram){e=t}i[t.type()]=t;this.modified();return true};this.shaderProgram=function(){return e};this.render=function(e){this.bind(e)};this.remove=function(e){this.undoBind(e)};this.bind=function(e){var t=null;for(t in i){if(i.hasOwnProperty(t)){i[t].bind(e)}}for(t in r){if(r.hasOwnProperty(t)){r[t].bind(e)}}};this.undoBind=function(e){var t=null;for(t in i){if(i.hasOwnProperty(t)){i[t].undoBind(e)}}for(t in r){if(r.hasOwnProperty(t)){r[t].undoBind(e)}}};this.bindVertexData=function(e,t){var r=null;for(r in i){if(i.hasOwnProperty(r)){i[r].bindVertexData(e,t)}}};this.undoBindVertexData=function(e,t){var r=null;for(r in i){if(i.hasOwnProperty(r)){i.undoBindVertexData(e,t)}}};return this};vgl.material.RenderBin={Base:0,Default:100,Opaque:100,Transparent:1e3,Overlay:1e4};inherit(vgl.material,vgl.object);vgl.renderState=function(){"use strict";this.m_modelViewMatrix=mat4.create();this.m_normalMatrix=mat4.create();this.m_projectionMatrix=null;this.m_material=null;this.m_mapper=null};vgl.renderer=function(){"use strict";if(!(this instanceof vgl.renderer)){return new vgl.renderer}vgl.object.call(this);var e=new vgl.groupNode,t=new vgl.camera,r=null,i=0,n=0,a=0,o=0,l=true,s=true;t.addChild(e);this.width=function(){return a};this.height=function(){return o};this.isResizable=function(){return l};this.setResizable=function(e){l=e};this.backgroundColor=function(){return t.clearColor()};this.setBackgroundColor=function(e,r,i,n){t.setClearColor(e,r,i,n);this.modified()};this.sceneRoot=function(){return e};this.camera=function(){return t};this.render=function(){var r,l,u,f=null,c=[],h=mat4.create(),d=null;gl.enable(gl.DEPTH_TEST);gl.depthFunc(gl.LEQUAL);if(t.clearMask()&vgl.GL.ColorBufferBit){d=t.clearColor();gl.clearColor(d[0],d[1],d[2],d[3])}if(t.clearMask()&vgl.GL.DepthBufferBit){gl.clearDepth(t.clearDepth())}gl.clear(t.clearMask());gl.viewport(i,n,a,o);l=new vgl.renderState;u=e.children();if(u.length>0&&s){this.resetCamera();s=false}for(r=0;r<u.length;++r){f=u[r];f.computeBounds();if(!f.visible()){continue}c.push([f.material().binNumber(),f])}c.sort(function(e,t){return e[0]-t[0]});for(r=0;r<c.length;++r){f=c[r][1];if(f.referenceFrame()===vgl.boundingObject.ReferenceFrame.Relative){mat4.multiply(l.m_modelViewMatrix,t.viewMatrix(),f.matrix());l.m_projectionMatrix=t.projectionMatrix()}else{l.m_modelViewMatrix=f.matrix();l.m_projectionMatrix=mat4.create();mat4.ortho(l.m_projectionMatrix,0,a,0,o,-1,1)}mat4.invert(h,l.m_modelViewMatrix);mat4.transpose(l.m_normalMatrix,h);l.m_material=f.material();l.m_mapper=f.mapper();l.m_material.render(l);l.m_mapper.render(l);l.m_material.remove(l)}};this.resetCamera=function(){t.computeBounds();var e=t.directionOfProjection(),r=t.bounds(),i=[(r[0]+r[1])/2,(r[2]+r[3])/2,(r[4]+r[5])/2],n=[r[1]-r[0],r[3]-r[2],r[5]-r[4]],a=0,o=t.viewAspect(),l=t.viewAngle(),s=null,u=null;if(n[0]>n[1]){if(n[0]>n[2]){a=n[0]/2}else{a=n[2]/2}}else{if(n[1]>n[2]){a=n[1]/2}else{a=n[2]/2}}if(o>=1){l=2*Math.atan(Math.tan(l*.5)/o)}else{l=2*Math.atan(Math.tan(l*.5)*o)}s=a/Math.sin(l*.5);u=t.viewUpDirection();if(Math.abs(vec3.dot(u,e))>.999){t.setViewUpDirection(-u[2],u[0],u[1])}t.setFocalPoint(i[0],i[1],i[2]);t.setPosition(i[0]+s*-e[0],i[1]+s*-e[1],i[2]+s*-e[2]);this.resetCameraClippingRange(r)};this.resetCameraClippingRange=function(e){var i=t.viewPlaneNormal(),n=t.position(),a=-i[0],o=-i[1],l=-i[2],s=-(a*n[0]+o*n[1]+l*n[2]),u=vec2.create(),f=null,c=null,h=null,d=null;if(typeof e==="undefined"){t.computeBounds();e=t.bounds()}u[0]=a*e[0]+o*e[2]+l*e[4]+s;u[1]=1e-18;for(d=0;d<2;d++){for(h=0;h<2;h++){for(c=0;c<2;c++){f=a*e[c]+o*e[2+h]+l*e[4+d]+s;u[0]=f<u[0]?f:u[0];u[1]=f>u[1]?f:u[1]}}}if(u[0]<0){u[0]=0}u[0]=.99*u[0]-(u[1]-u[0])*.5;u[1]=1.01*u[1]+(u[1]-u[0])*.5;u[0]=u[0]>=u[1]?.01*u[1]:u[0];if(!r){r=.01;if(gl!==null&&gl.getParameter(gl.DEPTH_BITS)>16){r=.001}}if(u[0]<r*u[1]){u[0]=r*u[1]}t.setClippingRange(u[0],u[1])};this.resize=function(e,t){this.positionAndResize(i,n,e,t)};this.positionAndResize=function(e,r,i,n){if(e<0||r<0||i<0||n<0){console.log("[error] Invalid position and resize values",e,r,i,n)}if(l){a=i;o=n;t.setViewAspect(a/o);this.modified()
}};this.addActor=function(t){if(t instanceof vgl.actor){e.addChild(t);this.modified();return true}return false};this.addActors=function(t){var r=null;if(t instanceof Array){for(r=0;r<t.length;++r){e.addChild(t[r])}this.modified()}};this.removeActor=function(t){if(e.children().indexOf(t)!==-1){e.removeChild(t);if(e.children().length===0){s=true}this.modified();return true}return false};this.removeActors=function(t){if(!(t instanceof Array)){return false}var r;for(r=0;r<t.length;++r){e.removeChild(t[r])}this.modified();return true};this.removeAllActors=function(){return e.removeChildren()};this.worldToDisplay=function(e,t,r,i,n){var a=mat4.create(),o=null,l=null,s=null,u=null,f=null;mat4.multiply(a,r,t);f=vec4.create();vec4.transformMat4(f,e,a);if(f[3]!==0){f[0]=f[0]/f[3];f[1]=f[1]/f[3];f[2]=f[2]/f[3];f[3]=1}o=Math.round((f[0]+1)/2*i);l=Math.round((1-f[1])/2*n);s=f[2];u=f[3];return vec4.fromValues(o,l,s,u)};this.displayToWorld=function(e,t,r,i,n){var a=2*e[0]/i-1,o=-(2*e[1]/n)+1,l=e[2],s=mat4.create(),u=null;mat4.multiply(s,r,t);mat4.invert(s,s);u=vec4.fromValues(a,o,l,1);vec4.transformMat4(u,u,s);if(u[3]!==0){u[0]=u[0]/u[3];u[1]=u[1]/u[3];u[2]=u[2]/u[3];u[3]=1}return u};this.focusDisplayPoint=function(){var e=t.focalPoint(),r=vec4.fromValues(e[0],e[1],e[2],1);return this.worldToDisplay(r,t.viewMatrix(),t.projectionMatrix(),a,o)};return this};inherit(vgl.renderer,vgl.object);var gl=null;vgl.renderWindow=function(e){"use strict";if(!(this instanceof vgl.renderWindow)){return new vgl.renderWindow(e)}vgl.object.call(this);var t=0,r=0,i=400,n=400,a=e,o=null,l=[];this.windowSize=function(){return[i,n]};this.setWindowSize=function(e,t){if(i!==e||n!==t){i=e;n=t;this.modified();return true}return false};this.windowPosition=function(){return[t,r]};this.setWindowPosition=function(e,i){if(t!==e||r!==i){t=e;r=i;this.modified();return true}return false};this.renderers=function(){return l};this.activeRenderer=function(){return o};this.addRenderer=function(e){if(this.hasRenderer(e)===false){l.push(e);if(o===null){o=e}e.camera().setClearMask(vgl.GL.DepthBufferBit);this.modified();return true}return false};this.removeRenderer=function(e){var t=l.indexOf(e);if(t!==-1){if(o===e){o=null}l=l.splice(t,1);this.modified();return true}return false};this.getRenderer=function(e){if(e<l.length){return l[e]}console.log("[WARNING] Out of index array");return null};this.hasRenderer=function(e){var t;for(t=0;t<l.length;++t){if(e===l[t]){return true}}return false};this.resize=function(e,i){this.positionAndResize(t,r,e,i);this.modified()};this.positionAndResize=function(e,a,o,s){t=e;r=a;i=o;n=s;var u;for(u=0;u<l.length;++u){l[u].positionAndResize(t,r,i,n)}this.modified()};this.createWindow=function(){gl=null;try{gl=a.getContext("webgl")||a.getContext("experimental-webgl");var e;for(e=0;e<l.length;++e){if(l[e].width()>i||l[e].width()===0||l[e].height()>n||l[e].height()===0){l[e].resize(t,r,i,n)}}return true}catch(o){}if(!gl){console("[ERROR] Unable to initialize WebGL. Your browser may not support it.")}return false};this.deleteWindow=function(){};this.render=function(){var e;for(e=0;e<l.length;++e){l[e].render()}};this.focusDisplayPoint=function(){return o.focusDisplayPoint()};this.displayToWorld=function(e,t,r,a){a=a===undefined?a=o:a;var l=a.camera();if(!r){r=a.focusDisplayPoint()}return a.displayToWorld(vec4.fromValues(e,t,r[2],1),l.viewMatrix(),l.projectionMatrix(),i,n)};return this};inherit(vgl.renderWindow,vgl.object);vgl.camera=function(){"use strict";if(!(this instanceof vgl.camera)){return new vgl.camera}vgl.groupNode.call(this);var e=Math.PI*30/180,t=vec4.fromValues(0,0,0,1),r=vec4.fromValues(0,0,-5,1),i=vec3.fromValues(0,0,0),n=vec4.fromValues(0,1,0,0),a=vec4.fromValues(1,0,0,0),o=.01,l=1e4,s=1,u=vec4.fromValues(0,0,-1,0),f=vec4.fromValues(0,0,1,0),c=mat4.create(),h=mat4.create(),d=vgl.timestamp(),g=vgl.timestamp(),v=-1,m=1,p=+1,b=-1,x=false,w=[1,1,1,1],y=1,T=vgl.GL.ColorBufferBit|vgl.GL.DepthBufferBit;this.viewAngle=function(){return e};this.setViewAngleDegrees=function(t){e=Math.PI*t/180;this.modified()};this.setViewAngle=function(t){e=t;this.modified()};this.position=function(){return t};this.setPosition=function(e,r,i){t=vec4.fromValues(e,r,i,1);this.modified()};this.focalPoint=function(){return r};this.setFocalPoint=function(e,t,i){r=vec4.fromValues(e,t,i,1);this.modified()};this.viewUpDirection=function(){return n};this.setViewUpDirection=function(e,t,r){n=vec4.fromValues(e,t,r,0);this.modified()};this.centerOfRotation=function(){return i};this.setCenterOfRotation=function(e){i=e;this.modified()};this.getClippingRange=function(){return[o,l]};this.setClippingRange=function(e,t){o=e;l=t;this.modified()};this.viewAspect=function(){return s};this.setViewAspect=function(e){s=e;this.modified()};this.isEnabledParallelProjection=function(){return x};this.enableParallelProjection=function(e){if(e!==x){x=e;this.modified();return true}return false};this.setParallelProjection=function(e,t,r,i){v=e;m=t;p=r;b=i;this.modified()};this.directionOfProjection=function(){this.computeDirectionOfProjection();return u};this.viewPlaneNormal=function(){this.computeViewPlaneNormal();return f};this.viewMatrix=function(){return this.computeViewMatrix()};this.projectionMatrix=function(){return this.computeProjectionMatrix()};this.clearMask=function(){return T};this.setClearMask=function(e){T=e;this.modified()};this.clearColor=function(){return w};this.setClearColor=function(e,t,r,i){w[0]=e;w[1]=t;w[2]=r;w[3]=i;this.modified()};this.clearDepth=function(){return y};this.setClearDepth=function(e){y=e;this.modified()};this.computeDirectionOfProjection=function(){vec3.subtract(u,r,t);vec3.normalize(u,u);this.modified()};this.computeViewPlaneNormal=function(){f[0]=-u[0];f[1]=-u[1];f[2]=-u[2]};this.zoom=function(e){if(e===0){return}e=e*vec3.distance(r,t);t[0]=r[0]-e*u[0];t[1]=r[1]-e*u[1];t[2]=r[2]-e*u[2];this.modified()};this.pan=function(e,i,n){t[0]+=e;t[1]+=i;t[2]+=n;r[0]+=e;r[1]+=i;r[2]+=n;this.modified()};this.computeOrthogonalAxes=function(){this.computeDirectionOfProjection();vec3.cross(a,u,n);vec3.normalize(a,a);this.modified()};this.rotate=function(e,o){e=.5*e*(Math.PI/180);o=.5*o*(Math.PI/180);var l=mat4.create(),s=new vec3.create;mat4.identity(l);s[0]=-i[0];s[1]=-i[1];s[2]=-i[2];mat4.translate(l,l,i);mat4.rotate(l,l,e,n);mat4.rotate(l,l,o,a);mat4.translate(l,l,s);vec4.transformMat4(t,t,l);vec4.transformMat4(r,r,l);vec4.transformMat4(n,n,l);vec4.normalize(n,n);this.computeOrthogonalAxes();this.modified()};this.computeViewMatrix=function(){if(d.getMTime()<this.getMTime()){mat4.lookAt(c,t,r,n);d.modified()}return c};this.computeProjectionMatrix=function(){if(g.getMTime()<this.getMTime()){if(!x){mat4.perspective(h,e,s,o,l)}else{console.log("paralle projection");mat4.ortho(h,v,m,b,p,o,l)}g.modified()}return h};this.computeDirectionOfProjection();return this};inherit(vgl.camera,vgl.groupNode);vgl.interactorStyle=function(){"use strict";if(!(this instanceof vgl.interactorStyle)){return new vgl.interactorStyle}vgl.object.call(this);var e=this,t=null;this.viewer=function(){return t};this.setViewer=function(r){if(r!==t){t=r;$(t).on(vgl.event.mousePress,e.handleMouseDown);$(t).on(vgl.event.mouseRelease,e.handleMouseUp);$(t).on(vgl.event.mouseMove,e.handleMouseMove);$(t).on(vgl.event.mouseOut,e.handleMouseOut);$(t).on(vgl.event.mouseWheel,e.handleMouseWheel);$(t).on(vgl.event.keyPress,e.handleKeyPress);$(t).on(vgl.event.mouseContextMenu,e.handleContextMenu);this.modified()}};this.handleMouseDown=function(e){return true};this.handleMouseUp=function(e){return true};this.handleMouseMove=function(e){return true};this.handleMouseOut=function(e){return true};this.handleMouseWheel=function(e){return true};this.handleKeyPress=function(e){return true};this.handleContextMenu=function(e){return true};return this};inherit(vgl.interactorStyle,vgl.object);vgl.trackballInteractorStyle=function(){"use strict";if(!(this instanceof vgl.trackballInteractorStyle)){return new vgl.trackballInteractorStyle}vgl.interactorStyle.call(this);var e=this,t=false,r=false,i=false,n,a={x:0,y:0},o={x:0,y:0};this.handleMouseMove=function(l){var s=e.viewer().canvas(),u=e.viewer().renderWindow().windowSize()[0],f=e.viewer().renderWindow().windowSize()[1],c=e.viewer().renderWindow().activeRenderer(),h=c.camera(),d=e.viewer().relMouseCoords(l),g,v,m,p,b,x,w,d,y,T,A,d,S;n=false;a={x:0,y:0};if(d.x<0||d.x>u){a.x=0;n=true}else{a.x=d.x}if(d.y<0||d.y>f){a.y=0;n=true}else{a.y=d.y}if(n===true){return}g=h.focalPoint();m=vec4.fromValues(g[0],g[1],g[2],1);v=c.worldToDisplay(m,h.viewMatrix(),h.projectionMatrix(),u,f);p=vec4.fromValues(a.x,a.y,v[2],1);b=vec4.fromValues(o.x,o.y,v[2],1);x=c.displayToWorld(p,h.viewMatrix(),h.projectionMatrix(),u,f);w=c.displayToWorld(b,h.viewMatrix(),h.projectionMatrix(),u,f);y=x[0]-w[0];T=x[1]-w[1];A=x[2]-w[2];if(i){h.pan(-y,-T,-A);e.viewer().render()}if(t){h.rotate(o.x-a.x,o.y-a.y);c.resetCameraClippingRange();e.viewer().render()}if(r){S=2*(a.y-o.y)/f;if(S>0){h.zoom(1-Math.abs(S))}else{h.zoom(1+Math.abs(S))}c.resetCameraClippingRange();e.viewer().render()}o.x=a.x;o.y=a.y;return false};this.handleMouseDown=function(n){var a;if(n.button===0){t=true}if(n.button===1){i=true}if(n.button===2){r=true}a=e.view.relMouseCoords(n);if(a.x<0){o.x=0}else{o.x=a.x}if(a.y<0){o.y=0}else{o.y=a.y}return false};this.handleMouseUp=function(e){if(e.button===0){t=false}if(e.button===1){i=false}if(e.button===2){r=false}return false};this.handleMouseWheel=function(t){var r=e.viewer().renderWindow().activeRenderer(),i=r.camera();if(t.originalEvent.wheelDelta<0){i.zoom(.9)}else{i.zoom(1.1)}r.resetCameraClippingRange();e.viewer().render();return true};return this};inherit(vgl.trackballInteractorStyle,vgl.interactorStyle);vgl.pvwInteractorStyle=function(){"use strict";if(!(this instanceof vgl.pvwInteractorStyle)){return new vgl.pvwInteractorStyle}vgl.trackballInteractorStyle.call(this);var e=this,t=false,r=false,i=false,n,a,o,l,s,u,f,c,h,d,g,v,m,p,b,x,w,y,T={x:0,y:0};function A(){o.resetCameraClippingRange();e.viewer().render()}this.handleMouseMove=function(S){var P=[],M=null,D=[],R=null;n=e.viewer().renderWindow().windowSize()[0];a=e.viewer().renderWindow().windowSize()[1];o=e.viewer().renderWindow().activeRenderer();l=o.camera();s=false;u=e.viewer().relMouseCoords(S);f={x:0,y:0};P=e.viewer().renderWindow().renderers();for(M=0;M<P.length;++M){if(o!==P[M]){D.push(P[M].camera())}}if(u.x<0||u.x>n){f.x=0;s=true}else{f.x=u.x}if(u.y<0||u.y>a){f.y=0;s=true}else{f.y=u.y}if(s===true){return}c=l.focalPoint();h=vec4.fromValues(c[0],c[1],c[2],1);d=o.worldToDisplay(h,l.viewMatrix(),l.projectionMatrix(),n,a);g=vec4.fromValues(f.x,f.y,d[2],1);v=vec4.fromValues(T.x,T.y,d[2],1);m=o.displayToWorld(g,l.viewMatrix(),l.projectionMatrix(),n,a);p=o.displayToWorld(v,l.viewMatrix(),l.projectionMatrix(),n,a);b=m[0]-p[0];x=m[1]-p[1];w=m[2]-p[2];if(i){l.pan(-b,-x,-w);A()}if(t){R=[T.x-f.x,T.y-f.y];l.rotate(R[0],R[1]);for(M=0;M<D.length;++M){D[M].rotate(R[0],R[1])}for(M=0;M<P.length;++M){P[M].resetCameraClippingRange()}A()}if(r){y=2*(f.y-T.y)/a;if(y>0){l.zoom(1-Math.abs(y))}else{l.zoom(1+Math.abs(y))}A()}T.x=f.x;T.y=f.y;return false};this.handleMouseDown=function(n){if(n.button===0){t=true}if(n.button===1){i=true}if(n.button===2){r=true}u=e.viewer().relMouseCoords(n);if(u.x<0){T.x=0}else{T.x=u.x}if(u.y<0){T.y=0}else{T.y=u.y}return false};this.handleMouseUp=function(n){var a=e.viewer().canvas();if(n.button===0){t=false}if(n.button===1){i=false}if(n.button===2){r=false}return false};return this};inherit(vgl.pvwInteractorStyle,vgl.trackballInteractorStyle);vgl.viewer=function(e){"use strict";if(!(this instanceof vgl.viewer)){return new vgl.viewer(e)}vgl.object.call(this);var t=this,r=e,i=true,n=null,a=vgl.renderer(),o=vgl.renderWindow(r);this.canvas=function(){return r};this.renderWindow=function(){return o};this.init=function(){if(o!==null){o.createWindow()}else{console.log("[ERROR] No render window attached")}};this.interactorStyle=function(){return n};this.setInteractorStyle=function(e){if(e!==n){n=e;n.setViewer(this);this.modified()}};this.handleMouseDown=function(e){if(i===true){var r=$.event.fix(e||window.event);if(e.button===2){r.preventDefault()}r.state="down";r.type=vgl.event.mousePress;$(t).trigger(r)}return true};this.handleMouseUp=function(e){if(i===true){var r=$.event.fix(e||window.event);r.preventDefault();r.state="up";r.type=vgl.event.mouseRelease;$(t).trigger(r)}return true};this.handleMouseMove=function(e){if(i===true){var r=$.event.fix(e||window.event);r.preventDefault();r.type=vgl.event.mouseMove;$(t).trigger(r)}return true};this.handleMouseWheel=function(e){if(i===true){var r=$.event.fix(e||window.event);r.preventDefault();r.type=vgl.event.mouseWheel;$(t).trigger(r)}return true};this.handleMouseOut=function(e){if(i===true){var r=$.event.fix(e||window.event);r.preventDefault();r.type=vgl.event.mouseOut;$(t).trigger(r)}return true};this.handleKeyPress=function(e){if(i===true){var r=$.event.fix(e||window.event);r.preventDefault();r.type=vgl.event.keyPress;$(t).trigger(r)}return true};this.handleContextMenu=function(e){if(i===true){var r=$.event.fix(e||window.event);r.preventDefault();r.type=vgl.event.contextMenu;$(t).trigger(r)}return false};this.relMouseCoords=function(e){var t=0,i=0,n=0,a=0,o=r;do{t+=o.offsetLeft-o.scrollLeft;i+=o.offsetTop-o.scrollTop}while(o=o.offsetParent);n=e.pageX-t;a=e.pageY-i;return{x:n,y:a}};this.render=function(){o.render()};this._init=function(){$(r).on("mousedown",this.handleMouseDown);$(r).on("mouseup",this.handleMouseUp);$(r).on("mousemove",this.handleMouseMove);$(r).on("mousewheel",this.handleMouseWheel);$(r).on("contextmenu",this.handleContextMenu);o.addRenderer(a)};this._init();return this};inherit(vgl.viewer,vgl.object);vgl.shader=function(e){"use strict";if(!(this instanceof vgl.shader)){return new vgl.shader(e)}vgl.object.call(this);var t=null,r=vgl.timestamp(),i=e,n="";this.shaderHandle=function(){return t};this.shaderType=function(){return i};this.shaderSource=function(){return n};this.setShaderSource=function(e){n=e;this.modified()};this.compile=function(){if(this.getMTime()<r.getMTime()){return t}gl.deleteShader(t);t=gl.createShader(i);gl.shaderSource(t,n);gl.compileShader(t);if(!gl.getShaderParameter(t,gl.COMPILE_STATUS)){console.log("[ERROR] An error occurred compiling the shaders: "+gl.getShaderInfoLog(t));console.log(n);gl.deleteShader(t);return null}r.modified();return t};this.attachShader=function(e){gl.attachShader(e,t)}};inherit(vgl.shader,vgl.object);vgl.shaderProgram=function(){"use strict";if(!(this instanceof vgl.shaderProgram)){return new vgl.shaderProgram}vgl.materialAttribute.call(this,vgl.materialAttributeType.ShaderProgram);var e=0,t=vgl.timestamp(),r=[],i=[],n={},a={},o={};this.queryUniformLocation=function(t){return gl.getUniformLocation(e,t)};this.queryAttributeLocation=function(t){return gl.getAttribLocation(e,t)};this.addShader=function(e){if(r.indexOf(e)>-1){return false}var t;for(t=0;t<r.length;++t){if(r[t].shaderType()===e.shaderType()){r.splice(r.indexOf(e),1)}}r.push(e);this.modified();return true};this.addUniform=function(e){if(i.indexOf(e)>-1){return false}i.push(e);this.modified()};this.addVertexAttribute=function(e,t){n[t]=e;this.modified()};this.uniformLocation=function(e){return a[e]};this.attributeLocation=function(e){return o[e]};this.uniform=function(e){var t;for(t=0;t<i.length;++t){if(i[t].name()===e){return i[t]}}return null};this.updateUniforms=function(){var e;for(e=0;e<i.length;++e){i[e].callGL(a[i[e].name()])}};this.link=function(){gl.linkProgram(e);if(!gl.getProgramParameter(e,gl.LINK_STATUS)){console.log("[ERROR] Unable to initialize the shader program.");return false}return true};this.use=function(){gl.useProgram(e)};this.cleanUp=function(){this.deleteVertexAndFragment();this.deleteProgram()};this.deleteProgram=function(){gl.deleteProgram(e)};this.deleteVertexAndFragment=function(){var e;for(e=0;e<r.length;++e){gl.deleteShader(r[e].shaderHandle())}};this.bind=function(n){var a=0;if(e===0||t.getMTime()<this.getMTime()){e=gl.createProgram();if(e===0){console.log("[ERROR] Cannot create Program Object");return false}for(a=0;a<r.length;++a){r[a].compile();r[a].attachShader(e)}this.bindAttributes();if(!this.link()){console.log("[ERROR] Failed to link Program");this.cleanUp()}this.use();this.bindUniforms();t.modified()}else{this.use()}for(a=0;a<i.length;++a){i[a].update(n,this)}this.updateUniforms()};this.undoBind=function(e){};this.bindVertexData=function(e,t){if(n.hasOwnProperty(t)){n[t].bindVertexData(e,t)}};this.undoBindVertexData=function(e,t){if(n.hasOwnProperty(t)){n[t].undoBindVertexData(e,t)}};this.bindUniforms=function(){var e;for(e=0;e<i.length;++e){a[i[e].name()]=this.queryUniformLocation(i[e].name())}};this.bindAttributes=function(){var t,r;for(t in n){r=n[t].name();gl.bindAttribLocation(e,t,r);o[r]=t}};return this};inherit(vgl.shaderProgram,vgl.materialAttribute);vgl.texture=function(){"use strict";if(!(this instanceof vgl.texture)){return new vgl.texture}vgl.materialAttribute.call(this,vgl.materialAttributeType.Texture);this.m_width=0;this.m_height=0;this.m_depth=0;this.m_textureHandle=null;this.m_textureUnit=0;this.m_pixelFormat=null;this.m_pixelDataType=null;this.m_internalFormat=null;this.m_image=null;var e=vgl.timestamp(),t=this;function r(){switch(t.m_textureUnit){case 0:gl.activeTexture(gl.TEXTURE0);break;case 1:gl.activeTexture(gl.TEXTURE1);break;case 2:gl.activeTexture(gl.TEXTURE2);break;case 3:gl.activeTexture(gl.TEXTURE3);break;case 4:gl.activeTexture(gl.TEXTURE4);break;case 5:gl.activeTexture(gl.TEXTURE5);break;case 6:gl.activeTexture(gl.TEXTURE6);break;case 7:gl.activeTexture(gl.TEXTURE7);break;case 8:gl.activeTexture(gl.TEXTURE8);break;case 9:gl.activeTexture(gl.TEXTURE9);break;case 10:gl.activeTexture(gl.TEXTURE10);break;case 11:gl.activeTexture(gl.TEXTURE11);break;case 12:gl.activeTexture(gl.TEXTURE12);break;case 13:gl.activeTexture(gl.TEXTURE13);break;case 14:gl.activeTexture(gl.TEXTURE14);break;case 15:gl.activeTexture(gl.TEXTURE15);break;default:throw"[error] Texture unit "+this.m_textureUnit+" is not supported"}}this.setup=function(t){r();gl.deleteTexture(this.m_textureHandle);this.m_textureHandle=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.m_textureHandle);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.pixelStorei(gl.UNPACK_ALIGNMENT,1);gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,true);if(this.m_image!==null){this.updateDimensions();this.computeInternalFormatUsingImage();gl.texImage2D(gl.TEXTURE_2D,0,this.m_internalFormat,this.m_pixelFormat,this.m_pixelDataType,this.m_image)}else{gl.texImage2D(gl.TEXTURE_2D,0,this.m_internalFormat,this.m_pixelFormat,this.m_pixelDataType,null)}gl.bindTexture(gl.TEXTURE_2D,null);e.modified()};this.bind=function(t){if(this.getMTime()>e.getMTime()){this.setup(t)}r();gl.bindTexture(gl.TEXTURE_2D,this.m_textureHandle)};this.undoBind=function(e){gl.bindTexture(gl.TEXTURE_2D,null)};this.image=function(){return this.m_image};this.setImage=function(e){if(e!==null){this.m_image=e;this.updateDimensions();this.modified();return true}return false};this.textureUnit=function(){return this.m_textureUnit};this.setTextureUnit=function(e){if(this.m_textureUnit===e){return false}this.m_textureUnit=e;this.modified();return true};this.width=function(){return this.m_width};this.setWidth=function(e){if(this.m_image===null){return false}this.m_width=e;this.modified();return true};this.depth=function(){return this.m_depth};this.setDepth=function(e){if(this.m_image===null){return false}this.m_depth=e;this.modified();return true};this.textureHandle=function(){return this.m_textureHandle};this.internalFormat=function(){return this.m_internalFormat};this.setInternalFormat=function(e){if(this.m_internalFormat!==e){this.m_internalFormat=e;this.modified();return true}return false};this.pixelFormat=function(){return this.m_pixelFormat};this.setPixelFormat=function(e){if(this.m_image===null){return false}this.m_pixelFormat=e;this.modified();return true};this.pixelDataType=function(){return this.m_pixelDataType};this.setPixelDataType=function(e){if(this.m_image===null){return false}this.m_pixelDataType=e;this.modified();return true};this.computeInternalFormatUsingImage=function(){this.m_internalFormat=gl.RGBA;this.m_pixelFormat=gl.RGBA;this.m_pixelDataType=gl.UNSIGNED_BYTE};this.updateDimensions=function(){if(this.m_image!==null){this.m_width=this.m_image.width;this.m_height=this.m_image.height;this.m_depth=0}};return this};inherit(vgl.texture,vgl.materialAttribute);vgl.lookupTable=function(){"use strict";if(!(this instanceof vgl.lookupTable)){return new vgl.lookupTable}vgl.texture.call(this);var e=vgl.timestamp(),t=[0,0];this.m_colorTable=[.07514311,.468049805,1,1,.247872569,.498782363,1,1,.339526309,.528909511,1,1,.409505078,.558608486,1,1,.468487184,.588057293,1,1,.520796675,.617435078,1,1,.568724526,.646924167,1,1,.613686735,.676713218,1,1,.656658579,.707001303,1,1,.698372844,.738002964,1,1,.739424025,.769954435,1,1,.780330104,.803121429,1,1,.821573924,.837809045,1,1,.863634967,.874374691,1,1,.907017747,.913245283,1,1,.936129275,.938743558,.983038586,1,.943467973,.943498599,.943398095,1,.990146732,.928791426,.917447482,1,1,.88332677,.861943246,1,1,.833985467,.803839606,1,1,.788626485,.750707739,1,1,.746206642,.701389973,1,1,.70590052,.654994046,1,1,.667019783,.610806959,1,1,.6289553,.568237474,1,1,.591130233,.526775617,1,1,.552955184,.485962266,1,1,.513776083,.445364274,1,1,.472800903,.404551679,1,1,.428977855,.363073592,1,1,.380759558,.320428137,1,.961891484,.313155629,.265499262,1,.916482116,.236630659,.209939162,1].map(function(e){return e*255});this.setup=function(t){if(this.textureUnit()===0){gl.activeTexture(gl.TEXTURE0)}else if(this.textureUnit()===1){gl.activeTexture(gl.TEXTURE1)}gl.deleteTexture(this.m_textureHandle);this.m_textureHandle=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.m_textureHandle);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.pixelStorei(gl.UNPACK_ALIGNMENT,1);this.m_width=this.m_colorTable.length/4;this.m_height=1;this.m_depth=0;gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.m_width,this.m_height,this.m_depth,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(this.m_colorTable));gl.bindTexture(gl.TEXTURE_2D,null);e.modified()};this.colorTable=function(){return this.m_colorTable};this.setColorTable=function(e){if(this.m_colorTable===e){return false}this.m_colorTable=e;this.modified();return true};this.range=function(){return t};this.setRange=function(e){if(t===e){return false}t=e;this.modified();return true};this.updateRange=function(e){if(!(e instanceof Array)){console.log("[error] Invalid data type for range. Requires array [min,max]")}if(e[0]<t[0]){t[0]=e[0];this.modified()}if(e[1]>t[1]){t[1]=e[1];this.modified()}};return this};inherit(vgl.lookupTable,vgl.texture);vgl.uniform=function(e,t){"use strict";if(!(this instanceof vgl.uniform)){return new vgl.uniform}this.getTypeNumberOfComponents=function(e){switch(e){case gl.FLOAT:case gl.INT:case gl.BOOL:return 1;case gl.FLOAT_VEC2:case gl.INT_VEC2:case gl.BOOL_VEC2:return 2;case gl.FLOAT_VEC3:case gl.INT_VEC3:case gl.BOOLT_VEC3:return 3;case gl.FLOAT_VEC4:case gl.INT_VEC4:case gl.BOOL_VEC4:return 4;case gl.FLOAT_MAT3:return 9;case gl.FLOAT_MAT4:return 16;default:return 0}};var r=e,i=t,n=[],a=1;n.length=this.getTypeNumberOfComponents(r);this.name=function(){return i};this.type=function(){return r};this.get=function(){return n};this.set=function(e){var t=0;if(n.length===16){for(t=0;t<16;++t){n[t]=e[t]}}else if(n.length===9){for(t=0;t<9;++t){n[t]=e[t]}}else if(n.length===4){for(t=0;t<4;++t){n[t]=e[t]}}else if(n.length===3){for(t=0;t<3;++t){n[t]=e[t]}}else if(n.length===2){for(t=0;t<2;++t){n[t]=e[t]}}else{n[0]=e}};this.callGL=function(e){if(this.m_numberElements<1){return}switch(r){case gl.BOOL:case gl.INT:gl.uniform1iv(e,n);break;case gl.FLOAT:gl.uniform1fv(e,n);break;case gl.FLOAT_VEC2:gl.uniform2fv(e,n);break;case gl.FLOAT_VEC3:gl.uniform3fv(e,n);break;case gl.FLOAT_VEC4:gl.uniform4fv(e,n);break;case gl.FLOAT_MAT3:gl.uniformMatrix3fv(e,gl.FALSE,n);break;case gl.FLOAT_MAT4:gl.uniformMatrix4fv(e,gl.FALSE,n);break;default:break}};this.update=function(e,t){};return this};vgl.modelViewUniform=function(e){"use strict";if(!(this instanceof vgl.modelViewUniform)){return new vgl.modelViewUniform(e)}if(e.length===0){e="modelViewMatrix"}vgl.uniform.call(this,gl.FLOAT_MAT4,e);this.set(mat4.create());this.update=function(e,t){this.set(e.m_modelViewMatrix)};return this};inherit(vgl.modelViewUniform,vgl.uniform);vgl.projectionUniform=function(e){"use strict";if(!(this instanceof vgl.projectionUniform)){return new vgl.projectionUniform(e)}if(e.length===0){e="projectionMatrix"}vgl.uniform.call(this,gl.FLOAT_MAT4,e);this.set(mat4.create());this.update=function(e,t){this.set(e.m_projectionMatrix)};return this};inherit(vgl.projectionUniform,vgl.uniform);vgl.floatUniform=function(e,t){"use strict";if(!(this instanceof vgl.floatUniform)){return new vgl.floatUniform(e,t)}if(e.length===0){e="floatUniform"}t=t===undefined?1:t;vgl.uniform.call(this,gl.FLOAT,e);this.set(t)};inherit(vgl.floatUniform,vgl.uniform);vgl.normalMatrixUniform=function(e){"use strict";if(!(this instanceof vgl.normalMatrixUniform)){return new vgl.normalMatrixUniform(e)}if(e.length===0){e="normalMatrix"}vgl.uniform.call(this,gl.FLOAT_MAT4,e);this.set(mat4.create());this.update=function(e,t){this.set(e.m_normalMatrix)};return this};inherit(vgl.normalMatrixUniform,vgl.uniform);vgl.vertexAttributeKeys={Position:0,Normal:1,TextureCoordinate:2,Color:3,Scalar:4,Scalar2:5,Scalar3:6,Scalar4:7,Scalar5:8,Scalar6:9,Scalar7:10,CountAttributeIndex:11};vgl.vertexAttribute=function(e){"use strict";if(!(this instanceof vgl.vertexAttribute)){return new vgl.vertexAttribute(e)}var t=e;this.name=function(){return t};this.bindVertexData=function(e,r){var i=e.m_mapper.geometryData(),n=i.sourceData(r),a=e.m_material.shaderProgram();gl.vertexAttribPointer(a.attributeLocation(t),n.attributeNumberOfComponents(r),n.attributeDataType(r),n.normalized(r),n.attributeStride(r),n.attributeOffset(r));gl.enableVertexAttribArray(a.attributeLocation(t))};this.undoBindVertexData=function(e,r){var i=e.m_material.shaderProgram();gl.disableVertexAttribArray(i.attributeLocation(t))}};vgl.source=function(){"use strict";if(!(this instanceof vgl.source)){return new vgl.source}vgl.object.call(this);this.create=function(){};return this};inherit(vgl.source,vgl.object);vgl.planeSource=function(){"use strict";if(!(this instanceof vgl.planeSource)){return new vgl.planeSource}vgl.source.call(this);var e=[0,0,0],t=[1,0,0],r=[0,1,0],i=[0,0,1],n=1,a=1,o=null;this.setOrigin=function(t,r,i){e[0]=t;e[1]=r;e[2]=i};this.setPoint1=function(e,r,i){t[0]=e;t[1]=r;t[2]=i};this.setPoint2=function(e,t,i){r[0]=e;r[1]=t;r[2]=i};this.create=function(){o=new vgl.geometryData;var l=[],s=[],u=[],f=[],c=[],h,d,g,v,m,p,b=0,x=0,w=0,y=0,T=[],A=[],S=[],P=[],M=[],D=null,R=null,_=null,C;l.length=3;s.length=2;u.length=3;f.length=3;c.length=3;for(h=0;h<3;h++){u[h]=t[h]-e[h];f[h]=r[h]-e[h]}m=(n+1)*(a+1);p=n*a*2;T.length=3*m;A.length=3*m;P.length=2*m;M.length=m;for(g=0,h=0;h<a+1;h++){s[1]=h/a;for(d=0;d<n+1;d++){s[0]=d/n;for(v=0;v<3;v++){l[v]=e[v]+s[0]*u[v]+s[1]*f[v]}T[b++]=l[0];T[b++]=l[1];T[b++]=l[2];S[w++]=1;S[w++]=1;S[w++]=1;A[x++]=i[0];A[x++]=i[1];A[x++]=i[2];P[y++]=s[0];P[y++]=s[1]}}for(h=0;h<a;h++){for(d=0;d<n;d++){c[0]=d+h*(n+1);c[1]=c[0]+1;c[2]=c[0]+n+2;c[3]=c[0]+n+1}}for(h=0;h<m;++h){M[h]=h}D=new vgl.triangleStrip;D.setIndices(M);R=vgl.sourceDataP3fv();R.pushBack(T);_=vgl.sourceDataC3fv();_.pushBack(S);C=vgl.sourceDataT2fv();C.pushBack(P);o.addSource(R);o.addSource(_);o.addSource(C);o.addPrimitive(D);return o}};inherit(vgl.planeSource,vgl.source);vgl.pointSource=function(){"use strict";if(!(this instanceof vgl.pointSource)){return new vgl.pointSource}vgl.source.call(this);var e=[],t=[],r=[],i=null;this.setPositions=function(t){if(t instanceof Array){e=t}else{console.log("[ERROR] Invalid data type for positions. Array is required.")}};this.setColors=function(e){if(e instanceof Array){t=e}else{console.log("[ERROR] Invalid data type for colors. Array is required.")}};this.setTextureCoordinates=function(e){if(e instanceof Array){r=e}else{console.log("[ERROR] Invalid data type for "+"texture coordinates. Array is required.")}};this.create=function(){i=new vgl.geometryData;if(e.length%3!==0){console.log("[ERROR] Invalid length of the points array");return}var n=e.length/3,a=0,o=[],l,s,u,f;o.length=n;for(a=0;a<n;++a){o[a]=a}l=new vgl.points;l.setIndices(o);s=vgl.sourceDataP3fv();s.pushBack(e);i.addSource(s);if(t.length>0&&t.length===e.length){u=vgl.sourceDataC3fv();u.pushBack(t);i.addSource(u)}else if(t.length>0&&t.length!==e.length){console.log("[ERROR] Number of colors are different than number of points")}if(r.length>0&&r.length===e.length){f=vgl.sourceDataT2fv();f.pushBack(r);i.addSource(f)}else if(r.length>0&&r.length/2!==e.length/3){console.log("[ERROR] Number of texture coordinates are different than number of points")}i.addPrimitive(l);return i}};inherit(vgl.pointSource,vgl.source);vgl.lineSource=function(e,t){"use strict";if(!(this instanceof vgl.lineSource)){return new vgl.lineSource}vgl.source.call(this);var r=e,i=t,n=null,a=null;this.setPositions=function(e){if(e instanceof Array){r=e;this.modified();return true}console.log("[ERROR] Invalid data type for positions. Array is required.");return false};this.setColors=function(e){if(e instanceof Array){i=e;this.modified();return true}console.log("[ERROR] Invalid data type for colors. Array is required.");return false};this.create=function(){if(!r){console.log("[error] Invalid positions");return}if(r.length%3!==0){console.log("[error] Line source requires 3d points");return}if(r.length%3!==0){console.log("[ERROR] Invalid length of the points array");return}var e=new vgl.geometryData,t=r.length/3,n,a=[],o,l,s;a.length=t;for(n=0;n<t;++n){a[n]=n}o=new vgl.lines;o.setIndices(a);l=vgl.sourceDataP3fv();l.pushBack(r);e.addSource(l);if(i&&i.length>0&&i.length===r.length){s=vgl.sourceDataC3fv();s.pushBack(i);e.addSource(s)}else if(i&&i.length>0&&i.length!==r.length){console.log("[error] Number of colors are different than number of points")}e.addPrimitive(o);return e}};inherit(vgl.lineSource,vgl.source);vgl.utils=function(){"use strict";if(!(this instanceof vgl.utils)){return new vgl.utils}vgl.object.call(this);return this};inherit(vgl.utils,vgl.object);vgl.utils.computePowerOfTwo=function(e,t){"use strict";t=t||1;while(t<e){t*=2}return t};vgl.utils.createTextureVertexShader=function(e){"use strict";var t=["attribute vec3 vertexPosition;","attribute vec3 textureCoord;","uniform mediump float pointSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","varying highp vec3 iTextureCoord;","void main(void)","{","gl_PointSize = pointSize;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);"," iTextureCoord = textureCoord;","}"].join("\n"),r=new vgl.shader(gl.VERTEX_SHADER);r.setShaderSource(t);return r};vgl.utils.createTextureFragmentShader=function(e){"use strict";var t=["varying highp vec3 iTextureCoord;","uniform sampler2D sampler2d;","uniform mediump float opacity;","void main(void) {","gl_FragColor = vec4(texture2D(sampler2d, vec2(iTextureCoord.s, iTextureCoord.t)).xyz, opacity);","}"].join("\n"),r=new vgl.shader(gl.FRAGMENT_SHADER);r.setShaderSource(t);return r};vgl.utils.createRgbaTextureFragmentShader=function(e){"use strict";var t=["varying highp vec3 iTextureCoord;","uniform sampler2D sampler2d;","void main(void) {","gl_FragColor = vec4(texture2D(sampler2d, vec2(iTextureCoord.s, iTextureCoord.t)).xyzw);","}"].join("\n"),r=new vgl.shader(gl.FRAGMENT_SHADER);
r.setShaderSource(t);return r};vgl.utils.createVertexShader=function(e){"use strict";var t=["attribute vec3 vertexPosition;","attribute vec3 vertexColor;","uniform mediump float pointSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","varying mediump vec3 iVertexColor;","varying highp vec3 iTextureCoord;","void main(void)","{","gl_PointSize = pointSize;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);"," iVertexColor = vertexColor;","}"].join("\n"),r=new vgl.shader(gl.VERTEX_SHADER);r.setShaderSource(t);return r};vgl.utils.createVertexShaderSolidColor=function(e){"use strict";var t=["attribute vec3 vertexPosition;","uniform mediump float pointSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","void main(void)","{","gl_PointSize = pointSize;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),r=new vgl.shader(gl.VERTEX_SHADER);r.setShaderSource(t);return r};vgl.utils.createVertexShaderColorMap=function(e,t,r){"use strict";var i=["attribute vec3 vertexPosition;","attribute float vertexScalar;","uniform mediump float pointSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float lutMin;","uniform float lutMax;","varying mediump float iVertexScalar;","void main(void)","{","gl_PointSize = pointSize;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);","iVertexScalar = (vertexScalar-lutMin)/(lutMax-lutMin);","}"].join("\n"),n=new vgl.shader(gl.VERTEX_SHADER);n.setShaderSource(i);return n};vgl.utils.createFragmentShader=function(e){"use strict";var t=["varying mediump vec3 iVertexColor;","uniform mediump float opacity;","void main(void) {","gl_FragColor = vec4(iVertexColor, opacity);","}"].join("\n"),r=new vgl.shader(gl.FRAGMENT_SHADER);r.setShaderSource(t);return r};vgl.utils.createPhongVertexShader=function(e){"use strict";var t=["attribute highp vec3 vertexPosition;","attribute mediump vec3 vertexNormal;","attribute mediump vec3 vertexColor;","uniform highp mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 normalMatrix;","varying highp vec4 varPosition;","varying mediump vec3 varNormal;","varying mediump vec3 iVertexColor;","void main(void)","{","varPosition = modelViewMatrix * vec4(vertexPosition, 1.0);","gl_Position = projectionMatrix * varPosition;","varNormal = vec3(normalMatrix * vec4(vertexNormal, 0.0));","iVertexColor = vertexColor;","}"].join("\n"),r=new vgl.shader(gl.VERTEX_SHADER);r.setShaderSource(t);return r};vgl.utils.createPhongFragmentShader=function(e){"use strict";var t=["precision mediump float;","varying vec3 varNormal;","varying vec4 varPosition;","varying mediump vec3 iVertexColor;","const vec3 lightPos = vec3(0.0, 0.0,10000.0);","const vec3 ambientColor = vec3(0.01, 0.01, 0.01);","const vec3 specColor = vec3(1.0, 1.0, 1.0);","void main() {","vec3 normal = normalize(varNormal);","vec3 lightDir = normalize(lightPos);","vec3 reflectDir = -reflect(lightDir, normal);","vec3 viewDir = normalize(-varPosition.xyz);","float lambertian = max(dot(lightDir,normal), 0.0);","float specular = 0.0;","if(lambertian > 0.0) {","float specAngle = max(dot(reflectDir, viewDir), 0.0);","specular = pow(specAngle, 64.0);","}","gl_FragColor = vec4(ambientColor +","lambertian*iVertexColor +","specular*specColor, 1.0);","}"].join("\n"),r=new vgl.shader(gl.FRAGMENT_SHADER);r.setShaderSource(t);return r};vgl.utils.createFragmentShaderSolidColor=function(e,t){"use strict";var r=["uniform mediump float opacity;","void main(void) {","gl_FragColor = vec4("+t[0]+","+t[1]+","+t[2]+", opacity);","}"].join("\n"),i=new vgl.shader(gl.FRAGMENT_SHADER);i.setShaderSource(r);return i};vgl.utils.createFragmentShaderColorMap=function(e){"use strict";var t=["varying mediump float iVertexScalar;","uniform sampler2D sampler2d;","uniform mediump float opacity;","void main(void) {","gl_FragColor = vec4(texture2D(sampler2d, vec2(iVertexScalar, 0.0)).xyz, opacity);","}"].join("\n"),r=new vgl.shader(gl.FRAGMENT_SHADER);r.setShaderSource(t);return r};vgl.utils.createPointSpritesVertexShader=function(e){"use strict";var t=["attribute vec3 vertexPosition;","attribute vec3 vertexColor;","uniform mediump vec2 pointSize;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float height;","varying mediump vec3 iVertexColor;","varying highp float iVertexScalar;","void main(void)","{","mediump float realPointSize = pointSize.y;","if (pointSize.x > pointSize.y) {","  realPointSize = pointSize.x;}","gl_PointSize = realPointSize ;","iVertexScalar = vertexPosition.z;","gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition.xy, height, 1.0);"," iVertexColor = vertexColor;","}"].join("\n"),r=new vgl.shader(gl.VERTEX_SHADER);r.setShaderSource(t);return r};vgl.utils.createPointSpritesFragmentShader=function(e){"use strict";var t=["varying mediump vec3 iVertexColor;","varying highp float iVertexScalar;","uniform sampler2D opacityLookup;","uniform highp float lutMin;","uniform highp float lutMax;","uniform sampler2D scalarsToColors;","uniform int useScalarsToColors;","uniform int useVertexColors;","uniform mediump vec2 pointSize;","uniform mediump float vertexColorWeight;","void main(void) {","mediump vec2 realTexCoord;","if (pointSize.x > pointSize.y) {","  realTexCoord = vec2(1.0, pointSize.y/pointSize.x) * gl_PointCoord;","} else {","  realTexCoord = vec2(pointSize.x/pointSize.y, 1.0) * gl_PointCoord;","}","highp float texOpacity = texture2D(opacityLookup, realTexCoord).w;","if (useScalarsToColors == 1) {","  gl_FragColor = vec4(texture2D(scalarsToColors, vec2((iVertexScalar - lutMin)/(lutMax - lutMin), 0.0)).xyz, texOpacity);","} else if (useVertexColors == 1) {","  gl_FragColor = vec4(iVertexColor, texOpacity);","} else {","  gl_FragColor = vec4(texture2D(opacityLookup, realTexCoord).xyz, texOpacity);","}}"].join("\n"),r=new vgl.shader(gl.FRAGMENT_SHADER);r.setShaderSource(t);return r};vgl.utils.createTextureMaterial=function(e){"use strict";var t=new vgl.material,r=new vgl.blend,i=new vgl.shaderProgram,n=vgl.utils.createTextureVertexShader(gl),a=null,o=new vgl.vertexAttribute("vertexPosition"),l=new vgl.vertexAttribute("textureCoord"),s=new vgl.floatUniform("pointSize",5),u=new vgl.modelViewUniform("modelViewMatrix"),f=new vgl.projectionUniform("projectionMatrix"),c=new vgl.uniform(gl.INT,"sampler2d"),h=null;c.set(0);i.addVertexAttribute(o,vgl.vertexAttributeKeys.Position);i.addVertexAttribute(l,vgl.vertexAttributeKeys.TextureCoordinate);i.addUniform(s);i.addUniform(u);i.addUniform(f);if(e){a=vgl.utils.createRgbaTextureFragmentShader(gl)}else{a=vgl.utils.createTextureFragmentShader(gl);h=new vgl.floatUniform("opacity",1);i.addUniform(h)}i.addShader(a);i.addShader(n);t.addAttribute(i);t.addAttribute(r);return t};vgl.utils.createGeometryMaterial=function(){"use strict";var e=new vgl.material,t=new vgl.blend,r=new vgl.shaderProgram,i=vgl.utils.createVertexShader(gl),n=vgl.utils.createFragmentShader(gl),a=new vgl.vertexAttribute("vertexPosition"),o=new vgl.vertexAttribute("vertexColor"),l=new vgl.floatUniform("pointSize",5),s=new vgl.floatUniform("opacity",1),u=new vgl.modelViewUniform("modelViewMatrix"),f=new vgl.projectionUniform("projectionMatrix");r.addVertexAttribute(a,vgl.vertexAttributeKeys.Position);r.addVertexAttribute(o,vgl.vertexAttributeKeys.Color);r.addUniform(l);r.addUniform(s);r.addUniform(u);r.addUniform(f);r.addShader(n);r.addShader(i);e.addAttribute(r);e.addAttribute(t);return e};vgl.utils.createPhongMaterial=function(){"use strict";var e=new vgl.material,t=new vgl.blend,r=new vgl.shaderProgram,i=vgl.utils.createPhongVertexShader(gl),n=vgl.utils.createPhongFragmentShader(gl),a=new vgl.vertexAttribute("vertexPosition"),o=new vgl.vertexAttribute("vertexNormal"),l=new vgl.vertexAttribute("vertexColor"),s=new vgl.floatUniform("opacity",1),u=new vgl.modelViewUniform("modelViewMatrix"),f=new vgl.normalMatrixUniform("normalMatrix"),c=new vgl.projectionUniform("projectionMatrix");r.addVertexAttribute(a,vgl.vertexAttributeKeys.Position);r.addVertexAttribute(o,vgl.vertexAttributeKeys.Normal);r.addVertexAttribute(l,vgl.vertexAttributeKeys.Color);r.addUniform(s);r.addUniform(u);r.addUniform(c);r.addUniform(f);r.addShader(n);r.addShader(i);e.addAttribute(r);e.addAttribute(t);return e};vgl.utils.createColorMaterial=function(){"use strict";var e=new vgl.material,t=new vgl.blend,r=new vgl.shaderProgram,i=vgl.utils.createVertexShader(gl),n=vgl.utils.createFragmentShader(gl),a=new vgl.vertexAttribute("vertexPosition"),o=new vgl.vertexAttribute("textureCoord"),l=new vgl.vertexAttribute("vertexColor"),s=new vgl.floatUniform("pointSize",5),u=new vgl.floatUniform("opacity",.5),f=new vgl.modelViewUniform("modelViewMatrix"),c=new vgl.projectionUniform("projectionMatrix");r.addVertexAttribute(a,vgl.vertexAttributeKeys.Position);r.addVertexAttribute(l,vgl.vertexAttributeKeys.Color);r.addVertexAttribute(o,vgl.vertexAttributeKeys.TextureCoordinate);r.addUniform(s);r.addUniform(u);r.addUniform(f);r.addUniform(c);r.addShader(n);r.addShader(i);e.addAttribute(r);e.addAttribute(t);return e};vgl.utils.createColorMappedMaterial=function(e){"use strict";if(!e){e=new vgl.lookupTable}var t=e.range(),r=new vgl.material,i=new vgl.blend,n=new vgl.shaderProgram,a=vgl.utils.createVertexShaderColorMap(gl,t[0],t[1]),o=vgl.utils.createFragmentShaderColorMap(gl),l=new vgl.vertexAttribute("vertexPosition"),s=new vgl.vertexAttribute("vertexScalar"),u=new vgl.floatUniform("pointSize",5),f=new vgl.floatUniform("opacity",.5),c=new vgl.floatUniform("lutMin",t[0]),h=new vgl.floatUniform("lutMax",t[1]),d=new vgl.modelViewUniform("modelViewMatrix"),g=new vgl.projectionUniform("projectionMatrix"),v=new vgl.uniform(gl.FLOAT,"sampler2d"),m=e;v.set(0);n.addVertexAttribute(l,vgl.vertexAttributeKeys.Position);n.addVertexAttribute(s,vgl.vertexAttributeKeys.Scalar);n.addUniform(u);n.addUniform(f);n.addUniform(c);n.addUniform(h);n.addUniform(d);n.addUniform(g);n.addShader(o);n.addShader(a);r.addAttribute(n);r.addAttribute(i);r.addAttribute(m);return r};vgl.utils.updateColorMappedMaterial=function(e,t){"use strict";if(!e){console.log("[warning] Invalid material. Nothing to update.");return}if(!t){console.log("[warning] Invalid lookup table. Nothing to update.");return}var r=e.shaderProgram().uniform("lutMin"),i=e.shaderProgram().uniform("lutMax");r.set(t.range()[0]);i.set(t.range()[1]);e.setAttribute(t)};vgl.utils.createSolidColorMaterial=function(e){"use strict";if(!e){e=[1,1,1]}var t=new vgl.material,r=new vgl.blend,i=new vgl.shaderProgram,n=vgl.utils.createVertexShaderSolidColor(gl),a=vgl.utils.createFragmentShaderSolidColor(gl,e),o=new vgl.vertexAttribute("vertexPosition"),l=new vgl.floatUniform("pointSize",5),s=new vgl.floatUniform("opacity",1),u=new vgl.modelViewUniform("modelViewMatrix"),f=new vgl.projectionUniform("projectionMatrix");i.addVertexAttribute(o,vgl.vertexAttributeKeys.Position);i.addUniform(l);i.addUniform(s);i.addUniform(u);i.addUniform(f);i.addShader(a);i.addShader(n);t.addAttribute(i);t.addAttribute(r);return t};vgl.utils.createPointSpritesMaterial=function(e,t){"use strict";var r=t===undefined?[0,1]:t.range(),i=new vgl.material,n=new vgl.blend,a=new vgl.shaderProgram,o=vgl.utils.createPointSpritesVertexShader(gl),l=vgl.utils.createPointSpritesFragmentShader(gl),s=new vgl.vertexAttribute("vertexPosition"),u=new vgl.vertexAttribute("vertexColor"),f=new vgl.floatUniform("height",0),c=new vgl.floatUniform("vertexColorWeight",0),h=new vgl.floatUniform("lutMin",r[0]),d=new vgl.floatUniform("lutMax",r[1]),g=new vgl.modelViewUniform("modelViewMatrix"),v=new vgl.projectionUniform("projectionMatrix"),m=new vgl.uniform(gl.INT,"opacityLookup"),p=new vgl.uniform(gl.INT,"scalarsToColors"),b=new vgl.uniform(gl.INT,"useScalarsToColors"),x=new vgl.uniform(gl.INT,"useVertexColors"),w=new vgl.uniform(gl.FLOAT_VEC2,"pointSize"),y=new vgl.texture;m.set(0);p.set(1);b.set(0);x.set(0);w.set([1,1]);a.addVertexAttribute(s,vgl.vertexAttributeKeys.Position);a.addVertexAttribute(u,vgl.vertexAttributeKeys.Color);a.addUniform(f);a.addUniform(c);a.addUniform(g);a.addUniform(v);a.addUniform(m);a.addUniform(x);a.addUniform(b);a.addUniform(w);a.addShader(l);a.addShader(o);i.addAttribute(a);i.addAttribute(n);if(t){a.addUniform(p);b.set(1);a.addUniform(h);a.addUniform(d);t.setTextureUnit(1);i.addAttribute(t)}y.setImage(e);y.setTextureUnit(0);i.addAttribute(y);return i};vgl.utils.createPlane=function(e,t,r,i,n,a,o,l,s){"use strict";var u=new vgl.mapper,f=new vgl.planeSource,c=vgl.utils.createGeometryMaterial(),h=new vgl.actor;f.setOrigin(e,t,r);f.setPoint1(i,n,a);f.setPoint2(o,l,s);u.setGeometryData(f.create());h.setMapper(u);h.setMaterial(c);return h};vgl.utils.createTexturePlane=function(e,t,r,i,n,a,o,l,s,u){"use strict";var f=new vgl.mapper,c=new vgl.planeSource,h=vgl.utils.createTextureMaterial(u),d=new vgl.actor;c.setOrigin(e,t,r);c.setPoint1(i,n,a);c.setPoint2(o,l,s);f.setGeometryData(c.create());d.setMapper(f);d.setMaterial(h);return d};vgl.utils.createPoints=function(e,t,r){"use strict";if(!e){console.log("[ERROR] Cannot create points without positions");return null}var i=new vgl.mapper,n=new vgl.pointSource,a=vgl.utils.createGeometryMaterial(),o=new vgl.actor;n.setPositions(e);if(t){n.setColors(t)}if(r){n.setTextureCoordinates(r)}i.setGeometryData(n.create());o.setMapper(i);o.setMaterial(a);return o};vgl.utils.createPointSprites=function(e,t,r,i){"use strict";if(!e){console.log("[ERROR] Point sprites requires an image");return null}if(!t){console.log("[ERROR] Cannot create points without positions");return null}var n=new vgl.mapper,a=new vgl.pointSource,o=vgl.utils.createPointSpritesMaterial(e),l=new vgl.actor;a.setPositions(t);if(r){a.setColors(r)}if(i){a.setTextureCoordinates(i)}n.setGeometryData(a.create());l.setMapper(n);l.setMaterial(o);return l};vgl.utils.createLines=function(e,t){"use strict";if(!e){console.log("[ERROR] Cannot create points without positions");return null}var r=new vgl.mapper,i=new vgl.lineSource,n=vgl.utils.createGeometryMaterial(),a=new vgl.actor;i.setPositions(e);if(t){i.setColors(t)}r.setGeometryData(i.create());a.setMapper(r);a.setMaterial(n);return a};vgl.utils.createColorLegend=function(e,t,r,i,n,a,o){"use strict";if(!t){console.log("[error] Invalid lookup table");return[]}function l(e,t,r){if(!t){console.log("[error] Create labels requires positions (x,y,z) array");return}if(t.length%3!==0){console.log("[error] Create labels require positions array contain 3d points");return}if(!r){console.log("[error] Create labels requires Valid range");return}var i=null,n=vgl.utils.computePowerOfTwo(48),a=0,o=[],l=[],s=[],u=[],f=t[6]-t[0],c=4,h;l.length=3;s.length=3;u.length=3;for(h=0;h<2;++h){a=h*(t.length-3);l[0]=t[a]-f;l[1]=t[a+1]-2*f;l[2]=t[a+2];s[0]=t[a]+f;s[1]=l[1];s[2]=l[2];u[0]=l[0];u[1]=t[1];u[2]=l[2];i=vgl.utils.createTexturePlane(l[0],l[1],l[2],s[0],s[1],s[2],u[0],u[1],u[2],true);i.setReferenceFrame(vgl.boundingObject.ReferenceFrame.Absolute);i.material().setBinNumber(vgl.material.RenderBin.Overlay);i.material().addAttribute(vgl.utils.create2DTexture(r[h].toFixed(2).toString(),12,null));o.push(i)}l[0]=(t[0]+t[t.length-3]-n)*.5;l[1]=t[1]+c;l[2]=t[2];s[0]=l[0]+n;s[1]=l[1];s[2]=l[2];u[0]=l[0];u[1]=l[1]+n;u[2]=l[2];i=vgl.utils.createTexturePlane(l[0],l[1],l[2],s[0],s[1],s[2],u[0],u[1],u[2],true);i.setReferenceFrame(vgl.boundingObject.ReferenceFrame.Absolute);i.material().setBinNumber(vgl.material.RenderBin.Overlay);i.material().addAttribute(vgl.utils.create2DTexture(e,24,null));o.push(i);return o}function s(e,t,r,i,n,a,o,s,u,f,c,h,d,g,v){var m=u-a,p=null,b=m/h,x=[],w=null,y=[];for(p=0;p<=h;++p){x.push(a+b*p);x.push(o);x.push(s);x.push(a+b*p);x.push(o+g);x.push(s)}w=vgl.utils.createLines(x,null);w.setReferenceFrame(vgl.boundingObject.ReferenceFrame.Absolute);w.material().setBinNumber(vgl.material.RenderBin.Overlay);y.push(w);y=y.concat(l(e,x,t.range()));return y}var u=r[0]+i,f=r[1],c=0,h=r[0],d=r[1]+n,g=0,v=[],m=null,p=null,b=null,x=vgl.groupNode();m=vgl.utils.createTexturePlane(r[0],r[1],r[2],u,f,c,h,d,g);b=m.material();b.addAttribute(t);m.setMaterial(b);x.addChild(m);m.setReferenceFrame(vgl.boundingObject.ReferenceFrame.Absolute);v.push(m);v=v.concat(s(e,t,r[0],r[1],r[1],h,f,c,u,f,c,a,o,5,3));return v};vgl.utils.create2DTexture=function(e,t,r,i,n,a,o){"use strict";var l=document.getElementById("textRendering"),s=null,u=vgl.texture();i=i||"sans-serif";n=n||"center";a=a||"bottom";if(typeof o==="undefined"){o=true}if(!l){l=document.createElement("canvas")}s=l.getContext("2d");l.setAttribute("id","textRendering");l.style.display="none";l.height=vgl.utils.computePowerOfTwo(8*t);l.width=l.height;s.fillStyle="rgba(0, 0, 0, 0)";s.fillRect(0,0,s.canvas.width,s.canvas.height);s.fillStyle="rgba(200, 85, 10, 1.0)";s.textAlign=n;s.textBaseline=a;s.font=4*t+"px "+i;if(o){s.font="bold "+s.font}s.fillText(e,l.width/2,l.height/2,l.width);u.setImage(l);u.updateDimensions();return u};vgl.picker=function(){"use strict";if(!(this instanceof vgl.picker)){return new vgl.picker}vgl.object.call(this);var e=this,t=.025,r=[];this.getActors=function(){return r};this.pick=function(e,t,i){if(typeof e==="undefined"){return 0}if(typeof t==="undefined"){return 0}if(typeof i==="undefined"){return 0}r=[];var n=i.camera(),a=i.width(),o=i.height(),l=n.focalPoint(),s=vec4.fromValues(l[0],l[1],l[2],1),u=i.worldToDisplay(s,n.viewMatrix(),n.projectionMatrix(),a,o),f=vec4.fromValues(e,t,u[2],1),c=i.displayToWorld(f,n.viewMatrix(),n.projectionMatrix(),a,o),h=n.position(),d=[],g,v,m,p,b,x,w,y,T,A,S;for(m=0;m<3;++m){d[m]=c[m]-h[m]}g=i.sceneRoot().children();v=0;for(m=0;m<g.length;++m){S=g[m];if(S.visible()===true){p=S.bounds();if(d[0]>=0){b=(p[0]-h[0])/d[0];x=(p[1]-h[0])/d[0]}else{b=(p[1]-h[0])/d[0];x=(p[0]-h[0])/d[0]}if(d[1]>=0){w=(p[2]-h[1])/d[1];y=(p[3]-h[1])/d[1]}else{w=(p[3]-h[1])/d[1];y=(p[2]-h[1])/d[1]}if(b>y||w>x){continue}if(w>b){b=w}if(y<x){x=y}if(d[2]>=0){T=(p[4]-h[2])/d[2];A=(p[5]-h[2])/d[2]}else{T=(p[5]-h[2])/d[2];A=(p[4]-h[2])/d[2]}if(b>A||T>x){continue}if(T>b){b=T}if(A<x){x=A}r[v++]=S}}return v};return this};inherit(vgl.picker,vgl.object);vgl.shapefileReader=function(){"use strict";if(!(this instanceof vgl.shapefileReader)){return new vgl.shapefileReader}var e=this;var t=8;var r=0;var i=1;var n=5;var a=3;this.int8=function(e,t){return e.charCodeAt(t)};this.bint32=function(e,t){return((e.charCodeAt(t)&255)<<24)+((e.charCodeAt(t+1)&255)<<16)+((e.charCodeAt(t+2)&255)<<8)+(e.charCodeAt(t+3)&255)};this.lint32=function(e,t){return((e.charCodeAt(t+3)&255)<<24)+((e.charCodeAt(t+2)&255)<<16)+((e.charCodeAt(t+1)&255)<<8)+(e.charCodeAt(t)&255)};this.bint16=function(e,t){return((e.charCodeAt(t)&255)<<8)+(e.charCodeAt(t+1)&255)};this.lint16=function(e,t){return((e.charCodeAt(t+1)&255)<<8)+(e.charCodeAt(t)&255)};this.ldbl64=function(e,t){var r=e.charCodeAt(t)&255;var i=e.charCodeAt(t+1)&255;var n=e.charCodeAt(t+2)&255;var a=e.charCodeAt(t+3)&255;var o=e.charCodeAt(t+4)&255;var l=e.charCodeAt(t+5)&255;var s=e.charCodeAt(t+6)&255;var u=e.charCodeAt(t+7)&255;var f=1-2*(u>>7);var c=((u&127)<<4)+((s&240)>>4)-1023;var h=(s&15)*Math.pow(2,48)+l*Math.pow(2,40)+o*Math.pow(2,32)+a*Math.pow(2,24)+n*Math.pow(2,16)+i*Math.pow(2,8)+r;return f*(1+h*Math.pow(2,-52))*Math.pow(2,c)};this.lfloat32=function(e,t){var r=e.charCodeAt(t)&255;var i=e.charCodeAt(t+1)&255;var n=e.charCodeAt(t+2)&255;var a=e.charCodeAt(t+3)&255;var o=1-2*(a>>7);var l=((a&127)<<1)+((n&254)>>7)-127;var s=(n&127)*Math.pow(2,16)+i*Math.pow(2,8)+r;return o*(1+s*Math.pow(2,-23))*Math.pow(2,l)};this.str=function(e,t,r){var i=[];var n=t;while(n<t+r){var a=e[n];if(a.charCodeAt(0)!==0)i.push(a);else{break}n++}return i.join("")};this.readHeader=function(e){var t=this.bint32(e,0);var r=this.bint32(e,24);var i=this.lint32(e,28);var n=this.lint32(e,32);var a=this.ldbl64(e,36);var o=this.ldbl64(e,44);var l=this.ldbl64(e,52);var s=this.ldbl64(e,60);return{code:t,length:r,version:i,shapetype:n,bounds:new Box(vect(a,o),vect(l,s))}};this.loadShx=function(t){var r=[];var i=function(i){r.push(2*e.bint32(t,i));return i+8};var n=100;while(n<t.length){n=i(n)}return r};this.Shapefile=function(e){var t=e.path;$.ajax({url:t+".shx",mimeType:"text/plain; charset=x-user-defined",success:function(r){var i=this.loadShx(r);$.ajax({url:t+".shp",mimeType:"text/plain; charset=x-user-defined",success:function(r){$.ajax({url:t+".dbf",mimeType:"text/plain; charset=x-user-defined",success:function(t){var n=this.loadShp(r,t,i,e);e.success(n)}})}})}})};this.localShapefile=function(t){var r=t.shx;var i=t.shp;var n=t.dbf;var a=new FileReader;a.onloadend=function(){var r=e.loadShx(a.result);var o=new FileReader;o.onloadend=function(){var i=o.result;var a=new FileReader;a.onloadend=function(){var n=a.result;var o=e.loadShp(i,n,r,t);t.success(o)};a.readAsBinaryString(n)};o.readAsBinaryString(i)};a.readAsBinaryString(r)};this.loadDBF=function(t){var r=function(r){var i=e.str(t,r,10);var n=e.str(t,r+11,1);var a=e.int8(t,r+16);return{name:i,type:n,length:a}};var i=e.int8(t,0);if(i==4){throw"Level 7 dBASE not supported"}var n=e.int8(t,1);var a=e.int8(t,2);var o=e.int8(t,3);var l=e.lint32(t,4);var s=e.lint16(t,8);var u=e.lint16(t,10);var f=32;var c=32;var h=f;var d=[];while(h<s-1){d.push(r(h));h+=c}var g=[];var v=s;while(v<s+l*u){var m=e.str(t,v,1);if(m=="*"){v+=u}else{v++;var p={};for(var b=0;b<d.length;b++){var x=d[b];var w;if(x.type=="C"){w=e.str(t,v,x.length).trim()}else if(x.type=="N"){w=parseFloat(e.str(t,v,x.length))}v+=x.length;p[x.name]=w}g.push(p)}}return g};this.loadShp=function(t,o,l,s){var u=[];var f=function(r,i,n){var a=[];for(var o=n-1;o>=i;o--){var l=e.ldbl64(t,r+16*o);var s=e.ldbl64(t,r+16*o+8);a.push([l,s])}return a};var c=function(o){var l=e.bint32(t,o);var s=e.bint32(t,o+4);var c=o+8;var h=e.lint32(t,c);if(h==r){console.log("NULL Shape")}else if(h==i){var d=e.ldbl64(t,c+4);var g=e.ldbl64(t,c+12);u.push({type:"Point",attr:{},geom:[[d,g]]})}else if(h==n){var v=e.lint32(t,c+36);var m=e.lint32(t,c+40);var p=o+52;var b=o+52+4*v;var x=[];for(var w=0;w<v;w++){var y=e.lint32(t,p+w*4);var T;if(w+1<v){T=e.lint32(t,p+(w+1)*4)}else{T=m}var A=f(b,y,T);x.push(A)}u.push({type:"Polygon",attr:{},geom:[x]})}else if(h==a){var v=e.lint32(t,c+36);var m=e.lint32(t,c+40);var p=o+52;var b=o+52+4*v;var x=[];for(var w=0;w<v;w++){var y=e.lint32(t,p+w*4);var T;if(w+1<v){T=e.lint32(t,p+(w+1)*4)}else{T=m}var A=f(b,y,T);x.push(A)}u.push({type:"Polyline",attr:{},geom:[x]})}else{throw"Not Implemented: "+h}};var h=this.loadDBF(o);for(var d=0;d<l.length;d++){var g=l[d];c(g)}var v=[];for(var d=0;d<u.length;d++){var m=u[d];m.attr=h[d];v.push(m)}return v};return this};vgl.vtkReader=function(){"use strict";if(!(this instanceof vgl.vtkReader)){return new vgl.vtkReader}var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],t=[],r={},i={},n=[],a=0,o=null,l=null,s=-1,u="",f=0,c=0,h=null,d=0;if(t.length===0){for(d=0;d<e.length;d++){t[e[d]]=d}}this.ntos=function(e){var t;t=e.toString(16);if(t.length===1){t="0"+t}t="%"+t;return unescape(t)};this.readReverseBase64=function(){var e;if(!u){return s}while(true){if(f>=u.length){return s}e=u.charAt(f);f++;if(t[e]){return t[e]}if(e==="A"){return 0}}return s};this.decode64=function(e){var t="",r=new Array(4),i=false;u=e;f=0;while(!i&&(r[0]=this.readReverseBase64())!==s&&(r[1]=this.readReverseBase64())!==s){r[2]=this.readReverseBase64();r[3]=this.readReverseBase64();t+=this.ntos(r[0]<<2&255|r[1]>>4);if(r[2]!==s){t+=this.ntos(r[1]<<4&255|r[2]>>2);if(r[3]!==s){t+=this.ntos(r[2]<<6&255|r[3])}else{i=true}}else{i=true}}return t};this.readNumber=function(e){var t=e[c++]+(e[c++]<<8)+(e[c++]<<16)+(e[c++]<<24);return t};this.readF3Array=function(e,t){var r=new Int8Array(e*4*3),i=null,n;for(n=0;n<e*4*3;n++){r[n]=t[c++]}i=new Float32Array(r.buffer);return i};this.readColorArray=function(e,t,r){var i,n,a,o,l=0,s=new Array(e*3);for(i=0;i<e;i++){s[l++]=t[c++]/255;s[l++]=t[c++]/255;s[l++]=t[c++]/255;c++}r.insert(s)};this.parseObject=function(e,t){var r=new vgl.geometryData,i=vgl.mapper(),n=[],a=null,o=null,l,s=null,u=null,f=null,h,g;o=atob(e.data);for(d=0;d<o.length;d++){n[d]=o.charCodeAt(d)&255}c=0;l=this.readNumber(n);a=String.fromCharCode(n[c++]);r.setName(a);if(a==="L"){s=this.parseLineData(r,n);u=vgl.utils.createGeometryMaterial()}else if(a==="M"){s=this.parseMeshData(r,n);u=vgl.utils.createPhongMaterial()}else if(a==="P"){s=this.parsePointData(r,n);u=vgl.utils.createGeometryMaterial()}else if(a==="C"){s=this.parseColorMapData(r,n,l);u=vgl.utils.createGeometryMaterial()}else{console.log("Ignoring unrecognized encoded data type "+a)}i.setGeometryData(r);if(e.hasTransparency){h=u.shaderProgram();g=h.uniform("opacity");h.addUniform(new vgl.floatUniform("opacity",.5));u.setBinNumber(1e3)}f=vgl.actor();f.setMapper(i);f.setMaterial(u);f.setMatrix(mat4.transpose(mat4.create(),s));t.addActor(f)};this.parseLineData=function(e,t){var r=null,i=null,n=null,a=mat4.create(),o,l,s,u,f,h,d,g,v=null,m=0;l=this.readNumber(t);v=new Array(l*3);r=new vgl.sourceDataP3fv;s=this.readF3Array(l,t);for(g=0;g<l;g++){v[m++]=s[g*3];v[m++]=s[g*3+1];v[m++]=s[g*3+2]}r.insert(v);e.addSource(r);i=new vgl.sourceDataC3fv;this.readColorArray(l,t,i);e.addSource(i);n=new vgl.lines;e.addPrimitive(n);o=this.readNumber(t);u=new Int8Array(o*2);for(g=0;g<o*2;g++){u[g]=t[c++]}f=new Uint16Array(u.buffer);n.setIndices(f);n.setPrimitiveType(gl.LINES);h=16*4;u=new Int8Array(h);for(g=0;g<h;g++){u[g]=t[c++]}d=new Float32Array(u.buffer);mat4.copy(a,d);return a};this.parseMeshData=function(e,t){var r=null,i=null,n=null,a=null,o=mat4.create(),l=null,s=null,u,f,h,d,g,v,m,p,b,x=null,w=0;f=this.readNumber(t);x=new Array(f*6);r=new vgl.sourceDataP3N3f;h=this.readF3Array(f,t);a=this.readF3Array(f,t);for(p=0;p<f;p++){x[w++]=h[p*3];x[w++]=h[p*3+1];x[w++]=h[p*3+2];x[w++]=a[p*3];x[w++]=a[p*3+1];x[w++]=a[p*3+2]}r.insert(x);e.addSource(r);i=new vgl.sourceDataC3fv;this.readColorArray(f,t,i);e.addSource(i);d=[];s=new vgl.triangles;u=this.readNumber(t);d=new Int8Array(u*2);for(p=0;p<u*2;p++){d[p]=t[c++]}g=new Uint16Array(d.buffer);s.setIndices(g);e.addPrimitive(s);v=16*4;d=new Int8Array(v);for(p=0;p<v;p++){d[p]=t[c++]}m=new Float32Array(d.buffer);mat4.copy(o,m);b=null;return o};this.parsePointData=function(e,t){var r,i,n,a,o,l=mat4.create(),s=null,u=null,f=null,h,g=null,v=0;r=this.readNumber(t);g=new Array(r*3);s=new vgl.sourceDataP3fv;i=this.readF3Array(r,t);n=new Uint16Array(r);for(d=0;d<r;d++){n[d]=d;g[v++]=i[d*3];g[v++]=i[d*3+1];g[v++]=i[d*3+2]}s.insert(g);e.addSource(s);u=new vgl.sourceDataC3fv;this.readColorArray(r,t,u);e.addSource(u);f=new vgl.points;f.setIndices(n);e.addPrimitive(f);o=16*4;a=new Int8Array(o);for(d=0;d<o;d++){a[d]=t[c++]}h=new Float32Array(a.buffer);mat4.copy(l,h);return l};this.parseColorMapData=function(e,t,r){return null};this.parseSceneMetadata=function(e,t){var r=o.Renderers[t],i=e.camera(),n,a,s;a=(r.size[0]-r.origin[0])*l.width;s=(r.size[1]-r.origin[1])*l.height;e.resize(a,s);i.setCenterOfRotation([r.LookAt[1],r.LookAt[2],r.LookAt[3]]);i.setViewAngleDegrees(r.LookAt[0]);i.setPosition(r.LookAt[7],r.LookAt[8],r.LookAt[9]);i.setFocalPoint(r.LookAt[1],r.LookAt[2],r.LookAt[3]);i.setViewUpDirection(r.LookAt[4],r.LookAt[5],r.LookAt[6]);if(t===0){n=r.Background1;e.setBackgroundColor(n[0],n[1],n[2],1)}};this.updateViewer=function(){var e,t,r,i,n,a;if(o===null){return h}a=this.clearVtkObjectData();for(i=o.Renderers.length-1;i>=0;i--){n=a[i];if(n===null||typeof n==="undefined"){continue}e=this.getRenderer(i);this.parseSceneMetadata(e,i);if(i>0){e.setResizable(false)}for(t=0;t<n.length;t++){r=n[t];this.parseObject(r,e)}}return h};this.createNewViewer=function(e){var t;if(h===null){l=e;h=vgl.viewer(e);h.init();i[0]=h.renderWindow().activeRenderer();h.renderWindow().resize(e.width,e.height);t=vgl.pvwInteractorStyle();h.setInteractorStyle(t)}return h};this.updateCanvas=function(e){l=e;h.renderWindow().resize(e.width,e.height);return h};this.addVtkObjectData=function(e){var t,i,o;if(r.hasOwnProperty(e.layer)===false){r[e.layer]=[]}t=r[e.layer];if(typeof t==="undefined"){console.log("Layer list undefined for layer: "+e.layer)}for(i=0;i<n.length;++i){o=n[i];if(e.md5===o){return}}n.push(e.md5);r[e.layer].push(e);a++};this.numObjects=function(){return a};this.clearVtkObjectData=function(){var e=r;r={};return e};this.getRenderer=function(e){var t;t=i[e];if(t===null||typeof t==="undefined"){if(e===0){console.log("Error: layer 0 redererer is active render but is missing from list");t=h.renderWindow().activeRenderer();i[e]=t;return t}t=new vgl.renderer;h.renderWindow().addRenderer(t);t.camera().setClearMask(vgl.GL.DepthBufferBit);i[e]=t}return t};this.setVtkScene=function(e){o=e};return this};